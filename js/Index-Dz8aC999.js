var e=Object.defineProperty,t=(t,s,n)=>((t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n)(t,"symbol"!=typeof s?s+"":s,n);import{W as s}from"./webgpuBasic-WoFTiwmu.js";import{bU as n,bV as a,bW as i,bp as o,bq as r,bN as l,bX as h,bL as c,bO as d,bR as u,bh as m,bY as p,bZ as w,br as b,bs as g,b_ as y,b$ as x,c0 as M,c1 as v,bo as f,bk as A,bn as I,c2 as j,bj as P,c3 as z,c4 as C,c5 as k,c6 as _,bS as L}from"./three-BbqIY5yL.js";import{g as O}from"./gsap-3GKaO8XO.js";import{d as D,z as N,A as E,g as S,j as U,F as V,o as W}from"./@vue-DISYwsDo.js";const q=D({__name:"Index",setup(e){const D=new class extends s{constructor(){super(new o(0,0,40)),t(this,"pixels",[]),t(this,"rayCaster",new n),t(this,"mouse",new a),t(this,"mesh"),t(this,"progress",i([0,0,0,0,0,0,0,0,0,0])),t(this,"clickPosition",i([new o(0,0,0),new o(0,0,0),new o(0,0,0),new o(0,0,0),new o(0,0,0),new o(0,0,0),new o(0,0,0),new o(0,0,0),new o(0,0,0),new o(0,0,0)])),t(this,"waveIndex",0)}load(){var e,t;this.renderer.setClearColor(new r(0)),this.init("#webgl"),this.light({type:"DirectionalLight",x:0,y:20,z:20,intensity:100}),this.light({type:"DirectionalLight",x:0,y:-20,z:20,intensity:100}),this.light({type:"AmbientLight",x:100,y:0,z:0,intensity:1e3}),this.createCanvas(),null==(e=this.renderer)||e.setAnimationLoop((()=>{var e,t;null==(e=this.stats)||e.begin(),this.time-=.002,this.renderer.renderAsync(this.scene,this.camera),null==(t=this.stats)||t.end()}));const s=new l(new h(.5,.5,.5),new c);null==(t=this.scene)||t.add(s),document.addEventListener("click",(e=>{this.mouse.x=e.clientX/this.innerWidth*2-1,this.mouse.y=-e.clientY/this.innerHeight*2+1,this.rayCaster.setFromCamera(this.mouse,this.camera);const t=this.waveIndex,n=this.rayCaster.intersectObjects([this.mesh]);if(n.length>0){s.position.copy(n[0].point);const e={value:0};O.to(e,{value:1,duration:1,ease:"expo.out",onStart:()=>{const e=this.clickPosition.array[t];e.x=n[0].point.x,e.y=n[0].point.y,e.z=n[0].point.z},onUpdate:()=>{this.progress.array[t]=e.value}}),this.waveIndex=(this.waveIndex+1)%10}}),!1)}createCanvas(){const e=new Image;e.src="./texture/earth_specular_2048.jpg";const t=1024;e.onload=()=>{const s=document.createElement("canvas");s.width=t,s.height=t;const n=s.getContext("2d");n.drawImage(e,0,0,t,t);const a=n.getImageData(0,0,t,t),i=a.data;this.pixels=Array.from(Array(t),(()=>Array(t).fill(0)));for(let e=0;e<i.length;e+=4){const s=e/4%t,n=Math.floor(e/4/t);this.pixels[s][n]=a.data[e]<20?1:0}this.addObject();for(let e=0;e<10;e++)this.addArcs()}}addArcs(){var e;const t=d(0),s=new u({color:16777215,transparent:!0,roughness:.5,metalness:.5});s.colorNode=m((()=>{const e=t.mul(2).clamp(0,1),s=t.mul(2).sub(1).clamp(0,1),n=f(A().x,e),a=f(s,A().x);return I(j(1,1,1,1),j(0,0,0,0),n.mul(a))}))();const n=(new o).randomDirection(),a=(new o).randomDirection(),i=[];for(let l=0;l<1e3;l++){const e=l/1e3,t=Math.sin(e*Math.PI),s=(new o).lerpVectors(n,a,e).normalize().multiplyScalar(1+.2*t);i.push(s)}const r=new p(i),h=new w(r,1e3,.005,10,!1),c=new l(h,s);c.scale.set(20,20,20),null==(e=this.scene)||e.add(c),O.to(t,{value:1,repeat:-1,duration:3,delay:Math.random(),ease:"power1.inOut"})}addObject(){var e,t;const s=5e4,n=(Math.sqrt(5)+1)/2,a=[];for(let l=0;l<s;l++){const e=l/s,t=2*Math.PI*l*n,i=Math.acos(1-2*e),r=Math.sin(i)*Math.cos(t)*20,h=Math.sin(i)*Math.sin(t)*20,c=20*Math.cos(i),d=new o(r,c,h),u=1-(Math.asin(c/20)/Math.PI+.5),m=1-(Math.atan2(h/20,r/20)+Math.PI)/(2*Math.PI);this.pixels[Math.floor(1024*m)][Math.floor(1024*u)]&&a.push(d)}const i=new b(.125,.125),r=new u({color:16777215,transparent:!0,roughness:.5,metalness:.5}),h=m((()=>{const e=A().sub(P(.5)).length(),t=z(.28,.5,e).oneMinus();return j(1,0,0,t).mul(1.5)}));r.colorNode=h();const c=new g(i,r,s),d=new y;for(let o=0;o<a.length;o++)d.position.set(a[o].x,a[o].y,a[o].z),d.lookAt(2*a[o].x,2*a[o].y,2*a[o].z),d.updateMatrix(),c.setMatrixAt(o,d.matrix);c.instanceMatrix.needsUpdate=!0,null==(e=this.scene)||e.add(c);const p=new x(20,64,64),w=new u({color:16777215,roughness:.5,metalness:.5}),M=m((()=>{const e=C(0).toVar();return k(10,(({i:t})=>{const s=this.clickPosition.element(t).sub(_).length().mul(.8).sub(L(0).add(this.progress.element(t))).mul(.15),n=z(.3,.35,s).oneMinus().mul(2);n.mulAssign(z(.15,.29,s)),n.mulAssign(z(.9,1,this.progress.element(t)).oneMinus()),e.addAssign(n)})),j(e,0,0,1)}));w.colorNode=M(),this.mesh=new l(p,w),null==(t=this.scene)||t.add(this.mesh)}sceneEnvironment(){(new M).setPath("./texture/").load("venice_sunset_1k.hdr",(e=>{e.mapping=v,this.scene.environment=e}))}};return N((()=>{D.load()})),E((()=>{D.destroy()})),(e,t)=>(W(),S(V,null,[t[0]||(t[0]=U("div",{id:"webgl"},null,-1)),t[1]||(t[1]=U("div",{class:"title-name"},"earth",-1))],64))}});export{q as default};
