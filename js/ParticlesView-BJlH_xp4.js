var t=Object.defineProperty,e=(e,n,s)=>((e,n,s)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s)(e,"symbol"!=typeof n?n+"":n,s);import{B as n}from"./base-Blzby6IQ.js";import{d as s,z as i,A as o,g as a,j as r,F as l,o as u}from"./@vue-DISYwsDo.js";import{c as d,B as p,d as m,S as c,A as g,V as h,l as f,n as b}from"./three-CQ-nF5qD.js";const v=s({__name:"ParticlesView",setup(t){const s=new class extends n{constructor(){super(),e(this,"particles")}load(){this.init("#webgl"),this.particlesTransformGeometry(),this.animate()}particlesTransformGeometry(){var t;let e=!0;const n=1e6,s=new d,i=new p(5,5,5,5,5,50),{array:o}=i.attributes.position,a=new Float32Array(3*n);s.setAttribute("position",new m(a,3));const r=new Float32Array(3*n);s.setAttribute("toPosition",new m(r,3));const l=new Float32Array(n);s.setAttribute("speed",new m(l,1));const u=new c({vertexShader:"\n              uniform float u_progress;\n              uniform float u_time;\n              uniform vec2 u_boundingBox;\n              uniform float u_speed;\n              attribute vec3 toPosition;\n              attribute float speed;\n              void main() {\n                vec3 dis = toPosition - position;             \n\n                float perecent = u_progress / speed;\n\n                vec3 pos;\n                if(perecent <= 1.0){\n                  pos = position + dis * perecent; \n                  float yDis =(toPosition.y-u_boundingBox.x)/(u_boundingBox.y-u_boundingBox.x);\n                  if(yDis<perecent){\n                    pos = toPosition;\n                  }\n\n                }else{\n                  pos = toPosition;\n                }\n               \n                gl_Position = projectionMatrix * modelViewMatrix * vec4(pos,1.0);\n                gl_PointSize = 3.0;\n              }\n            ",fragmentShader:"\n              void main(){\n                float strength = distance(gl_PointCoord,vec2(0.5,0.5));\n                float dis = length(gl_PointCoord - 0.5);\n                dis = smoothstep(0.5,0.0,dis);\n                strength = step(0.5,strength);\n                strength = 1.0 - strength;\n\n                if(strength == 0.0){\n                  discard;\n                }\n                if(dis == 0.0){\n                  discard;\n                }\n\n                gl_FragColor = vec4(1.0,1.0,1.0, strength);\n                \n              }\n            ",transparent:!0,blending:g,uniforms:{u_progress:{value:0},u_time:{value:0},u_speed:{value:.1},u_boundingBox:{value:new h}}});for(let d=0;d<n;d++)a[3*d]=o[3*d],a[3*d+1]=o[3*d+1],a[3*d+2]=o[3*d+2],r[3*d]=o[3*d],r[3*d+1]=o[3*d+1],r[3*d+2]=o[3*d+2],l[d]=.5+.5*Math.random();s.attributes.position.needsUpdate=!0,s.attributes.toPosition.needsUpdate=!0,s.attributes.speed.needsUpdate=!0,this.particles=new f(s,u),this.particles.position.set(0,0,0),this.particles.scale.set(30,30,30),this.particles.castShadow=!0,null==(t=this.scene)||t.add(this.particles),s.computeBoundingBox();const{min:v,max:_}=i.boundingBox||{min:new h(-2.5,-2.5),max:new h(2.5,2.5)};u.uniforms.u_boundingBox.value.set(v,_);const w={ParticleGeometryChange:()=>{let t;this.particles.material.uniforms.u_progress.value=0,e=!e,t=e?new p(5,5,5,5,5,50):new b(2.5,64,64);const i=t.attributes.position.array,o=t.attributes.position.count;let d=0;for(let e=0;e<n;e++)d%=o,a[3*e]=r[3*e],a[3*e+1]=r[3*e+1],a[3*e+2]=r[3*e+2],r[3*e]=i[3*d],r[3*e+1]=i[3*d+1],r[3*e+2]=i[3*d+2],l[e]=.5+.5*Math.random(),d++;s.attributes.position.needsUpdate=!0,s.attributes.toPosition.needsUpdate=!0,s.attributes.speed.needsUpdate=!0,t.computeBoundingBox();const{min:m,max:c}=t.boundingBox||{min:new h(.1,.2),max:new h(.11,.12)};u.uniforms.u_boundingBox.value.set(m,c)}};this.gui.add(w,"ParticleGeometryChange").name("几何体之间粒子变换")}animate(){var t,e;null==(t=this.stats)||t.begin(),requestAnimationFrame((()=>{this.animate()})),this.particles&&(this.particles.material.uniforms.u_time.value=this.clock.getDelta(),this.particles.material.uniforms.u_progress.value>1&&(this.particles.material.uniforms.u_progress.value=1),this.particles.material.uniforms.u_progress.value+=.01),this.renderer.render(this.scene,this.camera),null==(e=this.stats)||e.end()}};return i((()=>{s.load()})),o((()=>{s.destroy()})),(t,e)=>(u(),a(l,null,[e[0]||(e[0]=r("div",{id:"webgl"},null,-1)),e[1]||(e[1]=r("div",{class:"title-name"},"几何体粒子变换（1000000个粒子）",-1))],64))}});export{v as default};
