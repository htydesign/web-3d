var n=Object.defineProperty,e=(e,t,o)=>((e,t,o)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o)(e,"symbol"!=typeof t?t+"":t,o);import{B as t,L as o}from"./base-BylKBDcx.js";import{G as i,V as s,L as a,B as r,a as l,C as h,M as d,b as u,c,d as m,S as v,e as p,P as f,f as g,g as w,h as y,A as b,D as x,i as _,Q as C,j as T,k as P,W as S,l as A,T as U,F as M,m as z,n as G,o as E,p as j,q as L,r as B,E as N,s as k,t as I}from"./three-2d3GPISL.js";import{C as F}from"./canvasTexture-CB5P4OHK.js";import{d as O,r as D,z as W,A as q,g as R,j as K,F as V,k as X,o as Z,B as H,C as Q,u as Y}from"./@vue-B4sUqkWa.js";class ${constructor(){e(this,"group",new i)}init(n,e,t){const o=n.distanceTo(e),a=(new s).addVectors(n,e).multiplyScalar(.5),r=o/2-2,l=(new s).subVectors(n,e);l.normalize();const h=new C;h.setFromUnitVectors(new s(-1,0,0),l),this.group.name=t,this.group.visible=!1;const d=new i,u=new i;return this.group.add(d),this.group.add(u),d.add(this.line(n,h)),d.add(this.arrow(n,h)),d.add(this.dotLine(n,h,r,parseInt(o+""))),u.add(this.line(e,h)),u.add(this.arrow(e,h,-1)),u.add(this.dotLine(e,h,r,parseInt(o+""),-1)),this.group.add(this.text(a,o)),this.group}line(n,e){const t=new a({color:16777215,linewidth:1}),o=[new s(0,0,-1),new s(0,0,1)],i=(new r).setFromPoints(o),h=new l(i,t);return h.quaternion.multiply(e),h.position.copy(n),h}arrow(n,e,t=1){const o=new h(.25,1,8);o.translate(0,-.5,0);const i=new d({color:16777215}),s=new u(o,i);return s.quaternion.multiply(e),s.position.copy(n),s.rotateZ(Math.PI/2*t),s}dotLine(n,e,t,o,i=1){const a=new s(0,0,0);a.x+=1*i;const l=a.clone();l.x+=t*i;const h=new c(a,l),d=new r,u=new Float32Array(3*o);d.setAttribute("position",new m(u,3));const g=new Float32Array(3*o);d.setAttribute("toPosition",new m(g,3));for(let s=0;s<o;s++){const n=h.getPoint(s/o);g[3*s+0]=n.x,g[3*s+1]=n.y,g[3*s+2]=n.z;const e=h.getPoint(0);u[3*s+0]=e.x,u[3*s+1]=e.y,u[3*s+2]=e.z}d.attributes.position.needsUpdate=!0,d.attributes.toPosition.needsUpdate=!0;const w=new v({uniforms:{uTime:{value:0},uColor:{value:new p(16777215)}},vertexShader:"\n        attribute vec3 toPosition;\n        uniform float uTime;\n       \n          void main(){\n            vec3 newPosition = position;\n            if(newPosition.x < toPosition.x){\n             // newPosition.x += uTime;\n            }\n            newPosition =  toPosition;\n            \n            gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);\n            gl_PointSize = 3.0;\n          }\n        ",fragmentShader:"\n       uniform vec3 uColor;\n          void main(){           \n            gl_FragColor = vec4(uColor,1.0);\n          }\n        "}),y=new f(d,w);return y.quaternion.multiply(e),y.position.copy(n),y.onBeforeRender=()=>{w.uniforms.uTime.value+=.1},y}text(n,e){const t=new F,o=new g(t.init({text:e.toFixed(2)+"m",width:600})),i=new w(new y({map:o,color:16777215,blending:b,transparent:!0,side:x}));return i.position.copy(n),i.scale.set(3,1,1),i}fade(){new _.Tween(this.group.position).to({x:0,y:100,z:0},1e3).easing(_.Easing.Linear.None).start().onComplete((()=>{}))}hade(){}}const J={class:"color-list"},nn=["onClick"],en=O({__name:"CarModel",setup(n){const a=["#ff0000","#00ff00","#0000ff","#ffff00","#00ffff","#ff00ff","#ffffff"],l=D(0),h=new s(0,20,30);const m=new class extends t{constructor(){super(h),e(this,"baseGroup",new i),e(this,"torusGroup",new i),e(this,"annotationGroup",new i),e(this,"uniforms",{uTime:{value:0},uStartColor:{value:new p(16776960)},uEndColor:{value:new p(16711680)},uEnvMap:{value:null}}),e(this,"isChange",!1),e(this,"frontAnnotation"),e(this,"leftAnnotation"),e(this,"rightAnnotation"),e(this,"wheelGroup",[]),e(this,"isWheel",!1),e(this,"car",{run:!1}),e(this,"material"),e(this,"cubeCamera"),e(this,"door_rr_dummy"),e(this,"door_rf_dummy"),e(this,"door_lr_dummy"),e(this,"door_lf_dummy"),e(this,"bonnet_dummy"),e(this,"boot_dummy"),e(this,"onSelectColor",(n=>{l.value=n,this.changeColor(n)}))}load(){var n,e;this.init("#webgl"),this.animate(),null==(n=this.scene)||n.add(this.annotationGroup,this.baseGroup,this.torusGroup),this.torusGroup.visible=!1,this.loadModel(),this.light({type:"AmbientLight",x:50,y:50,z:50}),this.light({type:"AmbientLight",x:-50,y:50,z:50}),this.baseGeometry(),this.planeLight(),this.flow(),null==(e=this.controls)||e.addEventListener("change",this.change.bind(this)),this.annotationGroup.visible=!1,this.gui.add(this.annotationGroup,"visible").name("车身尺寸").onChange((n=>{})),this.createTubeGeo()}addEventControlsUpdate(){this.annotationGroup.children.forEach((n=>{"front"==n.name&&(this.frontAnnotation=n)}))}change(){var n,e,t,o,i,s,a,r,l;if(this.annotationGroup.visible){const h=new k;h.setFromQuaternion(this.controls.object.quaternion,"XYZ",!0);const d=h.x,u=h.y;h.z;const c=I.radToDeg(d),m=I.radToDeg(u);m<30&&m>-30&&c<-12&&c>-30?((null==(n=this.frontAnnotation)?void 0:n.visible)||(this.frontAnnotation.visible=!0),(null==(e=this.leftAnnotation)?void 0:e.visible)&&(this.leftAnnotation.visible=!1),(null==(t=this.rightAnnotation)?void 0:t.visible)&&(this.rightAnnotation.visible=!1)):m<-30&&c<-12?((null==(o=this.leftAnnotation)?void 0:o.visible)||(this.leftAnnotation.visible=!0),(null==(i=this.frontAnnotation)?void 0:i.visible)&&(this.frontAnnotation.visible=!1),(null==(s=this.rightAnnotation)?void 0:s.visible)&&(this.rightAnnotation.visible=!1)):m>30&&c<-12&&((null==(a=this.rightAnnotation)?void 0:a.visible)||(this.rightAnnotation.visible=!0),(null==(r=this.frontAnnotation)?void 0:r.visible)&&(this.frontAnnotation.visible=!1),(null==(l=this.leftAnnotation)?void 0:l.visible)&&(this.leftAnnotation.visible=!1))}}openAllDoor(n){new _.Tween(this.door_rr_dummy.rotation).to({x:0,y:0,z:n?Math.PI/2:0},1e3).easing(_.Easing.Linear.None).start(),new _.Tween(this.door_rf_dummy.rotation).to({x:0,y:0,z:n?Math.PI/2:0},1e3).easing(_.Easing.Linear.None).start(),new _.Tween(this.door_lr_dummy.rotation).to({x:0,y:0,z:n?-Math.PI/2:0},1e3).easing(_.Easing.Linear.None).start(),new _.Tween(this.door_lf_dummy.rotation).to({x:0,y:0,z:n?-Math.PI/2:0},1e3).easing(_.Easing.Linear.None).start(),new _.Tween(this.bonnet_dummy.rotation).to({x:n?Math.PI/4:0,y:0,z:0},1e3).easing(_.Easing.Linear.None).start(),new _.Tween(this.boot_dummy.rotation).to({x:n?-Math.PI/2:0,y:0,z:0},1e3).easing(_.Easing.Linear.None).start()}loadModel(){const n=new T,e=new P;e.setDecoderPath("./draco/"),n.setDRACOLoader(e),n.load("./models/gltf/car.glb",(n=>{var e;const t=n.scene;t.scale.set(5,5,5),t.position.set(0,2,0),t.rotateY(Math.PI),null==(e=this.scene)||e.add(t),t.traverse((n=>{n instanceof u&&(n.castShadow=!0)})),this.door_rr_dummy=t.getObjectByName("door_rr_dummy");const o=this.createSprite();o.position.set(.1,-.8,.25),this.door_rr_dummy.add(o),this.door_rf_dummy=t.getObjectByName("door_rf_dummy");const i=this.createSprite();i.position.set(.1,-.95,.15),this.door_rf_dummy.add(i),this.door_lr_dummy=t.getObjectByName("door_lr_dummy");const a=this.createSprite();a.position.set(-.1,-.8,.25),this.door_lr_dummy.add(a),this.door_lf_dummy=t.getObjectByName("door_lf_dummy");const r=this.createSprite();r.position.set(-.1,-.95,.15),this.door_lf_dummy.add(r),this.bonnet_dummy=t.getObjectByName("bonnet_dummy");const l=this.createSprite();l.position.set(0,1,-.1),this.bonnet_dummy.add(l),this.boot_dummy=t.getObjectByName("boot_dummy");const d=this.createSprite();d.position.set(0,-.55,-.1),this.boot_dummy.add(d);const c={open:!1};this.gui.add(c,"open").name("开启全部车门").onChange((n=>{this.openAllDoor(n)})),this.wheelGroup=[t.getObjectByName("wheel"),t.getObjectByName("wheel001"),t.getObjectByName("wheel002"),t.getObjectByName("wheel003")];const m=t.getObjectByName("chassis_primary_0");m.geometry.computeBoundingBox();const v=m.geometry.boundingBox&&m.geometry.boundingBox.max.multiplyScalar(5)||{x:0,y:0,z:0},f=m.geometry.boundingBox&&m.geometry.boundingBox.min.multiplyScalar(5)||{x:0,y:0,z:0};this.frontAnnotation=(new $).init(new s(f.x,4,14),new s(v.x,4,14),"front"),this.rightAnnotation=(new $).init(new s(6,f.z+Math.abs(f.z)+2,0),new s(6,v.z+Math.abs(f.z)+2,0),"right"),this.leftAnnotation=(new $).init(new s(-6,4,f.y+2),new s(-6,4,v.y+4),"left"),this.annotationGroup.add(this.frontAnnotation,this.rightAnnotation,this.leftAnnotation);const g=new S(256);this.cubeCamera=new A(.1,1e3,g);const w=m.material;w.color.setHex(16777215*Math.random());const y={...this.uniforms,uEnvMap:{value:g.texture}};w.roughness=0,w.metalness=.8,w.color=new p(16777215),this.gui.add(w,"roughness",0,1,.1).name("roughness"),this.gui.add(w,"metalness",0,1,.1).name("metalness"),w.onBeforeCompile=n=>{Object.assign(n.uniforms,y),n.vertexShader=`\n          varying vec2 vUv;\n          ${n.vertexShader}\n          `,n.vertexShader=n.vertexShader.replace("#include <fog_vertex>","\n          #include <fog_vertex>\n            vUv = uv;\n          "),n.fragmentShader=`\n          uniform float uTime;\n          varying vec2 vUv;\n          uniform vec3 uStartColor;\n          uniform vec3 uEndColor;\n          uniform sampler2D uEnvMap;\n          ${n.fragmentShader}\n        `,n.fragmentShader=n.fragmentShader.replace("vec4 diffuseColor = vec4( diffuse, opacity );","\n            vec4 diffuseColor = vec4( diffuse, opacity );\n\n             //中心点\n            vec2 center = vUv - vec2(0.45);\n\n            float negationTime = -uTime;\n\n            vec3 color = uEndColor;\n\n            if(center.y > uTime){\n                color = uStartColor;\n            }\n            if(center.y < negationTime){\n                color = uStartColor;\n            }\n            vec3 envColor = texture2D(uEnvMap, vUv).rgb;\n\n            // color += envColor;\n\n            diffuseColor = vec4(color,diffuseColor.a);\n\n          ")},this.gui.add(this.car,"run").name("是否开启轮子").onChange((n=>{c.open=!1,this.openAllDoor(!1),n?new _.Tween(this.camera.position).to({x:20,y:5,z:20},2e3).easing(_.Easing.Linear.None).onUpdate((()=>{var n,e;null==(n=this.controls)||n.target.set(0,0,0),null==(e=this.controls)||e.update()})).start().onComplete((()=>{new _.Tween(this.baseGroup.position).to({x:0,y:-4,z:0},2e3).easing(_.Easing.Linear.None).start().onComplete((()=>{})),new _.Tween(t.position).to({x:0,y:0,z:0},1e3).easing(_.Easing.Linear.None).start().onComplete((()=>{this.isWheel=!0,this.torusGroup.visible=!0,w.envMap=g.texture}))})):(this.isWheel=!1,this.torusGroup.visible=!1,w.envMap=null,new _.Tween(t.position).to({x:0,y:2,z:0},1e3).easing(_.Easing.Linear.None).delay(1e3).start().onComplete((()=>{})),new _.Tween(this.baseGroup.position).to({x:0,y:0,z:0},2e3).easing(_.Easing.Linear.None).start().onComplete((()=>{new _.Tween(this.camera.position).to({x:h.x,y:h.y,z:h.z},2e3).easing(_.Easing.Linear.None).onUpdate((()=>{var n,e;null==(n=this.controls)||n.target.set(0,0,0),null==(e=this.controls)||e.update()})).start()})))}))}))}createSprite(){const n=(new U).load("./texture/sprite.png"),e=new r;e.setAttribute("position",new M([0,0,0],3));return new f(e,new z({map:n,color:16777215,blending:b,transparent:!0,depthTest:!1,side:x,size:1}))}createTubeGeo(){const n=new G;n.add(new c(new s(-1e3,0,0),new s(1e3,0,0)));const e=new E(n,128,50,8,!1);this.material=new v({side:x,uniforms:{uTime:{value:0}},vertexShader:"\n        varying vec2 vUv;\n\n        void main(){\n          vUv = uv;\n          vec4 mvPosition = modelViewMatrix * vec4(position,1.0);\n          gl_Position = projectionMatrix * mvPosition;\n        }\n      ",fragmentShader:"\n        varying vec2 vUv;\n        uniform float uTime;\n\n        // https://www.shadertoy.com/view/Msf3WH\n        vec2 hash(vec2 p)// replace this by something better\n        {\n            p=vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)));\n            return-1.+2.*fract(sin(p)*43758.5453123);\n        }\n\n        float noise(in vec2 p)\n        {\n            const float K1=.366025404;// (sqrt(3)-1)/2;\n            const float K2=.211324865;// (3-sqrt(3))/6;\n\n            vec2 i=floor(p+(p.x+p.y)*K1);\n            vec2 a=p-i+(i.x+i.y)*K2;\n            float m=step(a.y,a.x);\n            vec2 o=vec2(m,1.-m);\n            vec2 b=a-o+K2;\n            vec2 c=a-1.+2.*K2;\n            vec3 h=max(.5-vec3(dot(a,a),dot(b,b),dot(c,c)),0.);\n            vec3 n=h*h*h*h*vec3(dot(a,hash(i+0.)),dot(b,hash(i+o)),dot(c,hash(i+1.)));\n            return dot(n,vec3(70.));\n        }\n        vec3 palette( in float t, in vec3 a, in vec3 b, in vec3 c, in vec3 d )\n        {\n            return a + b*cos( 6.283185*(c*t+d) );\n        }\n\n        void main(){\n          vec2 noiseUv = vUv;\n          // noiseUv.x+=uTime*.5;\n          noiseUv.x = mod((vUv.x+uTime) * 1.0 , 1.0);\n\n          //  noiseUv.x = fract(mod((vUv.x+uTime), 1.0)*2.0);\n\n          float mask = noise(noiseUv * vec2(5.0,100.0));\n          mask = smoothstep(0.20,0.5,mask);\n          // mask = step(0.5,mask);\n          // mask = pow(mask, 2.0);\n          // mask = 1.0 - mask;\n\n          mask *= smoothstep(0.00,0.5,vUv.x)*smoothstep(0.00,0.5,1.0-vUv.x);\n          mask *= smoothstep(0.20,0.5,vUv.y)*smoothstep(0.20,0.5,1.0-vUv.y);\n\n          vec3 col= palette(mask,vec3(0.5),vec3(0.35),vec3(0.9),vec3(0.00, 0.33, 0.67));\n          col *= vec3(2.,1.,500.);\n          gl_FragColor = vec4(col,mask);\n        }\n      ",transparent:!0,blending:b,opacity:0});const t=new u(e,this.material);t.rotateX(Math.PI/2),t.rotateZ(Math.PI/2),this.torusGroup.add(t)}baseGeometry(){var n;const e=new j(15,15,1,64),t=new L({color:3355443}),o=new u(e,t);o.position.set(0,1.5,0),o.receiveShadow=!0,o.name="cylinder1",this.baseGroup.add(o);const i=new j(20,20,1,64),s=new L({color:4473924}),a=new u(i,s);a.position.set(0,.5,0),a.receiveShadow=!0,a.name="cylinder2",this.baseGroup.add(a);const r=new B(200,200),l=new L({color:2236962}),h=new u(r,l);h.position.set(0,0,0),h.rotateX(-Math.PI/2),h.receiveShadow=!0,null==(n=this.scene)||n.add(h);const d=new B(200,200,80,80),c=new v({vertexShader:"\n        varying vec2 vUv;\n\n        uniform float uTime;\n\n        void main() {\n            vUv = uv;\n            vec4 newPosition = modelMatrix * vec4(position, 1.0);\n\n            //中间凸起\n            float dist = distance(vUv, vec2(0.5));\n            float strength = smoothstep(0.15, 0.05, dist);\n            //float s = smoothstep(0.2, 0.05, abs(uv.x - 0.5 + 0.5 * sin(uTime)));\n              // newPosition.y -= 8.0 ;\n              // newPosition.y += 8.0 *s;\n            newPosition.y += 8.0 * strength;\n\n            gl_Position = projectionMatrix * viewMatrix * newPosition;\n\n\n        }\n      ",fragmentShader:"\n        varying vec2 vUv;\n\n        uniform float uTime;\n        uniform float uRepeat;\n        uniform float lightWidth;\n        uniform float uSpeed;\n\n        void main(){\n           // 先居中，再绘制圆形\n\n            float dis = distance(vUv, vec2(0.5));\n\n            float dist = fract((length(vUv - vec2(0.5)) /0.707 - uTime * uSpeed) * uRepeat);\n            float radius = lightWidth + dis / 4.0;\n            vec3 color = vec3(step(radius, dist));\n\n            float alpha = 1.0;\n            if(color.r == 1.0){\n              alpha = 0.0;\n            }\n            color+= vec3(1.0);\n\n            vec4 vColor = vec4(color, alpha);\n\n            float len = distance(vUv, vec2(0.5));\n            float strength = smoothstep(0.5, 0.35, len);\n            vColor.a *= strength;\n\n\n            gl_FragColor = vColor;\n\n        }\n      ",transparent:!0,uniforms:{uTime:{value:0},uRepeat:{value:10},lightWidth:{value:.01},uSpeed:{value:.01}},wireframe:!1,side:x,depthTest:!1}),m=new u(d,c);m.position.set(0,3,0),m.rotateX(-Math.PI/2),m.onBeforeRender=()=>{c.uniforms.uTime.value+=.05},m.visible=!1,this.baseGroup.add(m);const p=this.gui.addFolder("扩散光纹");p.add(c.uniforms.lightWidth,"value",.01,.5,.01).name("宽度"),p.add(c.uniforms.uRepeat,"value",1,30,1).name("数量"),p.add(c.uniforms.uSpeed,"value",.01,.05,.01).name("速度"),p.add(m,"visible").name("是否可见")}changeColor(n){this.isChange=!1,this.uniforms.uTime.value=0,this.uniforms.uStartColor.value=this.uniforms.uEndColor.value,this.uniforms.uEndColor.value=new p(a[n])}updateColor(){this.isChange||(this.uniforms.uTime.value<=1?this.uniforms.uTime.value+=.01:this.isChange=!0)}environment(){const n=(new U).load("/texture/sky.jpg");n.mapping=N,this.scene.background=n}planeLight(){var n;const e=new B(5,20),t=new d({color:16777215,transparent:!0,opacity:1,side:x}),i=new u(e,t);i.position.set(0,15,0),i.rotateX(-Math.PI/2),(new o).init(i,this.gui,{type:"SpotLight",intensity:5e3}),null==(n=this.scene)||n.add(i),this.gui.add(i,"visible").name("灯光可见")}flow(){var n;const e=new B(50,10,50,20),t=new v({transparent:!0,side:x,vertexShader:"\n        varying vec2 vUv;\n        uniform float uTime;\n        void main() {\n          vUv = uv;\n          vec4 newPosition = modelMatrix * vec4(position, 1.0);\n\n          float dist = distance(vUv, vec2(0.50));\n          float strength = smoothstep(0.0, 0.5, dist);         \n          \n          newPosition.y -= 2.0 * strength;\n\n          float strength2 = smoothstep(0.3, 0.0, abs(uv.x - 0.5));\n          newPosition.y += 3.0 * strength2;\n\n          float strength3 = smoothstep(0.4, 0.0, uv.x);\n          newPosition.y -= 5.0 * strength3;\n\n          gl_Position = projectionMatrix * viewMatrix * newPosition;\n        }\n      ",fragmentShader:"\n        varying vec2 vUv;\n        uniform float uTime;\n        void main(){\n          float vColor = step(0.85, fract(vUv.y * 10.0));\n          vec3 color = vec3(vColor);\n          if(color.g==0.0){\n            discard;\n          }\n          float d = mod((vUv.x - uTime) * 1.0 , 1.0);\n          float alpha = smoothstep(0.0, 1.0, d);\n          \n          float d2 = mod((vUv.x - uTime) * 1.0 , 1.0) ;\n          float alpha2 = smoothstep(0.0, 1.0, d2);\n          \n\n          gl_FragColor = vec4(color,alpha+alpha2);\n        }\n      ",uniforms:{uTime:{value:0}},wireframe:!1}),o=new u(e,t);o.position.set(0,8.5,-2),o.rotateX(-Math.PI/2),o.rotateZ(Math.PI/2),o.onBeforeRender=()=>{t.uniforms.uTime.value+=.01},null==(n=this.scene)||n.add(o),this.gui.add(o,"visible").name("气流可见")}animate(){var n,e;null==(n=this.stats)||n.begin(),requestAnimationFrame((()=>{this.animate()})),_.update(),this.updateColor(),this.isWheel&&(this.wheelGroup.forEach((n=>{n.rotation.x-=.2})),this.cubeCamera&&(this.cubeCamera.update(this.renderer,this.scene),this.material.uniforms.uTime.value+=.01)),this.renderer.render(this.scene,this.camera),null==(e=this.stats)||e.end()}};return W((()=>{m.load()})),q((()=>{m.gui.close(),m.gui.destroy()})),(n,e)=>(Z(),R(V,null,[e[0]||(e[0]=K("div",{id:"webgl"},null,-1)),K("div",J,[(Z(),R(V,null,X(a,((n,e)=>K("div",{class:H(["color-item",l.value==e?"active":""]),key:e,style:Q({background:n}),onClick:n=>Y(m).onSelectColor(e)},null,14,nn))),64))])],64))}});export{en as default};
