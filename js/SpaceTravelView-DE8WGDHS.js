var e=Object.defineProperty,n=(n,a,t)=>((n,a,t)=>a in n?e(n,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[a]=t)(n,"symbol"!=typeof a?a+"":a,t);import{B as a}from"./base-Vw92jU6n.js";import{n as t,o as s,ai as o,C as r,K as i,V as l,x as c,b as d,M as u}from"./three-CO0a1xEL.js";import{d as v,z as m,A as g,g as h,j as f,F as p,o as P}from"./@vue-B4sUqkWa.js";const b=v({__name:"SpaceTravelView",setup(e){const v=new class extends a{constructor(){super(),n(this,"positions",[]),n(this,"particles")}load(){this.init("#webgl"),this.animate(),this.scene.background=new r(3355443),this.renderer.localClippingEnabled=!0,this.light({type:"AmbientLight",x:0,y:200,z:100}),this.loadModel()}loadModel(){const e=new i(new l(0,1,0),0),n=new i(new l(0,-1,0),0),a=new c(100,50),v=new d(a,new u({color:16777215}));var m;v.rotateX(-Math.PI/2),(m="./models/gltf/Michelle.glb",new Promise((e=>{const n=new t,a=new s;a.setDecoderPath("./draco/"),n.setDRACOLoader(a),n.load(m,(n=>{e(n)}))}))).then((a=>{var t;const s=a.scene;s.scale.set(50,50,50),null==(t=this.scene)||t.add(s);const o={uPosY:{value:0},uColor:{value:new r(16776960)}};s.traverse((a=>{if(a instanceof d){a.material.clippingPlanes=[e];const{max:t,min:r}=a.geometry.boundingBox,i=t.y-r.y;s.scale.y;this.gui.add(o.uPosY,"value",0,i,.01).name("剪切高度").onChange((a=>{o.uPosY.value=a,e.constant=-a*s.scale.y,n.constant=a*s.scale.y,v.position.y=a*s.scale.y})),this.gui.addColor(o.uColor,"value").name("剪切颜色").onChange((e=>{o.uColor.value=e})),a.material.onBeforeCompile=e=>{Object.assign(e.uniforms,o),e.vertexShader=`\n            varying vec2 vUv;\n            varying float vPostionY;\n            ${e.vertexShader}\n            `,e.vertexShader=e.vertexShader.replace("#include <fog_vertex>","\n            #include <fog_vertex>\n                vUv = uv;\n                vPostionY = position.y;\n            "),e.fragmentShader=`\n            uniform float uPosY;\n            uniform vec3 uColor;\n            varying vec2 vUv;\n            varying float vPostionY;\n\n\n            ${e.fragmentShader}\n            `,e.fragmentShader=e.fragmentShader.replace("#include <dithering_fragment>","#include <dithering_fragment>\n                \n\n                if(vPostionY > uPosY && vPostionY <= uPosY + 0.1){\n                    gl_FragColor.rgb = mix(uColor, gl_FragColor.rgb, smoothstep(0.0,0.5,(vPostionY- uPosY) / 0.1));\n                }\n                \n              ")}}}))})),function(e){return new Promise((n=>{(new o).load(e,(e=>{n(e)}))}))}("./models/obj/male02/male02.obj").then((e=>{var a;const t=e;t.scale.set(.45,.45,.45),null==(a=this.scene)||a.add(t),t.traverse((e=>{e instanceof d&&(e.material.clippingPlanes=[n])}))}))}animate(){var e,n;null==(e=this.stats)||e.begin(),requestAnimationFrame((()=>{this.animate()})),this.renderer&&this.renderer.render(this.scene,this.camera),this.particles&&(this.particles.rotation.y+=.001),null==(n=this.stats)||n.end()}};return m((()=>{v.load()})),g((()=>{v.gui.close(),v.gui.destroy()})),(e,n)=>(P(),h(p,null,[n[0]||(n[0]=f("div",{id:"webgl"},null,-1)),n[1]||(n[1]=f("div",{class:"title-name"},"模型切换",-1))],64))}});export{b as default};
