var e=Object.defineProperty,t=(t,i,n)=>((t,i,n)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n)(t,"symbol"!=typeof i?i+"":i,n);import{B as i}from"./base-MCXJ8rIx.js";import{G as n,aE as s,aF as a,I as r,P as o,M as l,D as d,O as c,j as u,S as h,A as v,b as m,a as p,aG as f,aH as y}from"./three-DKcIG4Oh.js";import{d as g,r as w,z as x,A as b,g as M,j as P,C as j,F as A,o as C}from"./@vue-DISYwsDo.js";import{_ as T}from"./index-DQdaZlIk.js";import"./pinia-DkR6u-JQ.js";import"./vue-router-DW_NBBT6.js";const U=T(g({__name:"MusicViewTwo",setup(e){const g=w(!1);const T=new class extends i{constructor(){super(),t(this,"box"),t(this,"planeGroup",new n),t(this,"sound"),t(this,"audioLoader",new s),t(this,"listener",new a),t(this,"analyser"),t(this,"fftSize",128),t(this,"cylinder"),t(this,"topVertices",[])}load(){this.init("#webgl"),this.animate(),this.gridHelper(),this.createRound()}createRound(){const e=this.fftSize/2,t=new r(new o(1,20),new l({color:16777215,side:d}),e);t.instanceMatrix.needsUpdate=!0;const i=new c;for(let n=0;n<e;n++){const s=100*Math.cos(n*(Math.PI/180)*(360/e)),a=100*Math.sin(n*(Math.PI/180)*(360/e));i.position.set(s,0,a),i.lookAt(0,0,0),i.updateMatrix(),t.setMatrixAt(n,i.matrix)}this.createCylinder(e,100,20)}createCylinder(e,t,i){var n;const s=new u(t,t,i,e,1,!0),a=new Array(e).fill(i),r=new h({side:d,transparent:!0,wireframe:!1,depthTest:!1,blending:v,uniforms:{uTime:{value:0},uPositionArray:{value:[...a.map((e=>e*Math.random()))]}},vertexShader:`\n        uniform float uTime;\n        uniform float uPositionArray[${e}];\n\n        varying float vTime;\n\n        varying vec2 vUv;\n\n        void main() {\n          vTime = uTime;\n          vUv = uv;\n          vec3 newPosition = position;\n\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);\n        }\n      `,fragmentShader:"\n        uniform float uTime;\n        varying float vTime;\n        varying vec2 vUv;\n\n        void main() {\n         //渐变色\n          vec3 finalColor = vec3(1.0,1.0,1.0);      \n          if(vUv.x > 0.5){\n            finalColor = mix(vec3(1.0,0.0,1.0), vec3(1.0,1.0,0.0), vUv.x); \n          }else{\n            finalColor = mix(vec3(1.0,1.0,0.0), vec3(1.0,0.0,1.0), vUv.x);\n          }\n          \n\n          float alpha = smoothstep(0.0, 1.0, vUv.y);\n\n          gl_FragColor = vec4(finalColor, alpha);\n        }\n      "});this.cylinder=new m(s,r);const o=this.cylinder.geometry.attributes.position;for(let l=0;l<o.count;l++){const e=o.array[3*l+1],t=o.array[3*l+0],i=o.array[3*l+2];e>0&&this.topVertices.push({index:l,vertice:new p(t,e,i)})}null==(n=this.scene)||n.add(this.cylinder)}getAudio(){this.sound=new f(this.listener),this.audioLoader.load("./music/xiaomeiman.mp3",(e=>{var t,i;null==(t=this.sound)||t.setBuffer(e),null==(i=this.sound)||i.play()})),this.analyser=new y(this.sound,this.fftSize)}updatePosition(e){if(!this.cylinder)return!1;const t=this.cylinder.geometry.attributes.position,i=[],n=[],s=[];for(let r=0;r<e.length;r++)r<e.length/2?n.push(e[r]):s.push(e[r-e.length/2]);i.push(...n,...s.reverse()),i.push(e[0]);const a=this.topVertices.map(((e,t)=>({index:e.index,vertice:new p(e.vertice.x,i[t]/2,e.vertice.z)})));for(let r=0;r<i.length;r++)t.setXYZ(a[r].index,a[r].vertice.x,a[r].vertice.y,a[r].vertice.z);t.needsUpdate=!0}destroy(){var e;null==(e=this.sound)||e.stop()}animate(){var e,t;null==(e=this.stats)||e.begin(),requestAnimationFrame((()=>{this.animate()})),this.renderer.render(this.scene,this.camera),this.analyser&&(this.analyser.getFrequencyData(),this.updatePosition(this.analyser.data)),null==(t=this.stats)||t.end()}},U=()=>{T.getAudio()};return x((()=>{T.load()})),b((()=>{T.gui.close(),T.gui.destroy(),T.destroy()})),(e,t)=>(C(),M(A,null,[t[0]||(t[0]=P("div",{id:"webgl"},null,-1)),t[1]||(t[1]=P("div",{class:"title-name"},"music2",-1)),P("div",{class:j(["measure",g.value?"active":""]),onClick:U}," click play music ",2)],64))}}),[["__scopeId","data-v-664a5dde"]]);export{U as default};
