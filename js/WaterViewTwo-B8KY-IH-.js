var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{B as s}from"./base-BaImv3YL.js";import{T as i,V as a,Q as r,a as n,W as h,aK as o,b7 as u,aJ as l,S as c,m as d,M as m,A as v,P as p,b as x,a5 as g}from"./three-CyihR34C.js";import{d as w,z as b,A as M,g as f,j as y,F as W,o as T}from"./@vue-DISYwsDo.js";const j=w({__name:"WaterViewTwo",setup(e){const w=new class extends s{constructor(){super(new n(0,0,5)),t(this,"textureLoader",new i),t(this,"meshes",[]),t(this,"orthographicCamera"),t(this,"mouse",new a),t(this,"prevMouse",new a),t(this,"currentWave",0),t(this,"count",100),t(this,"scene1",new r),t(this,"baseTexture"),t(this,"quad"),t(this,"shaderMaterial"),t(this,"time",0)}load(){var e;this.init("#webgl"),null==(e=this.controls)||e.dispose(),this.baseTexture=new h(this.innerWidth,this.innerHeight,{minFilter:o,magFilter:o,format:u});const t=this.innerHeight,s=this.innerWidth/this.innerHeight;this.orthographicCamera=new l(-t*s/2,t*s/2,t/2,-t/2,-1e3,1e3),this.orthographicCamera.position.set(0,0,2),this.orthographicCamera.updateProjectionMatrix(),this.animate(),this.addObject(),this.mouseEvent()}mouseEvent(){window.addEventListener("mousemove",(e=>{this.mouse.x=e.clientX-this.innerWidth/2,this.mouse.y=this.innerHeight/2-e.clientY}))}addObject(){var e;const t=this.textureLoader.load("./texture/ocean.jpg");this.shaderMaterial=new c({uniforms:{uTexture:{value:t},uDisplacement:{value:null==(e=this.baseTexture)?void 0:e.texture},resolution:{value:new d(this.innerWidth,this.innerHeight,0,0)}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n      ",fragmentShader:"\n        uniform sampler2D uTexture;\n        uniform sampler2D uDisplacement;\n        uniform vec4 resolution;\n        varying vec2 vUv;\n\n        float PI = 3.1415926535897932384626433832795;\n\n        void main() {\n          vec2 newUv = (vUv - vec2(0.5, 0.5)) * resolution.zw + vec2(0.5, 0.5);\n\n          vec4 displacement = texture2D(uDisplacement, vUv);\n\n          float theta = displacement.r * PI * 2.0;\n\n          vec2 dir = vec2(sin(theta), cos(theta));\n\n          vec2 uv = vUv + dir * displacement.r * 0.1;\n\n          vec4 color = texture2D(uTexture, uv);\n\n          gl_FragColor = color;\n        }\n      "});const s=this.textureLoader.load("./texture/brush.png"),i=new m({map:s,transparent:!0,blending:v,depthTest:!1,depthWrite:!1}),a=new p(64,64);for(let n=0;n<this.count;n++){const e=new x(a,i.clone());e.rotation.z=2*Math.PI*Math.random(),e.visible=!1,this.scene.add(e),this.meshes.push(e)}const r=new p(this.innerWidth,this.innerHeight);this.quad=new x(r,this.shaderMaterial),this.scene1.add(this.quad)}setNewWave(e,t){const{x:s,y:i}=e,a=this.meshes[t];a.visible=!0,a.position.set(s,i,0),a.material.opacity=.5,a.scale.x=a.scale.y=a.scale.z=.2}trackMousePos(){Math.abs(this.mouse.x-this.prevMouse.x)<4&&Math.abs(this.mouse.y-this.prevMouse.y)<4||(this.setNewWave(this.mouse,this.currentWave),this.currentWave=(this.currentWave+1)%this.count),this.prevMouse.x=this.mouse.x,this.prevMouse.y=this.mouse.y}animate(){var e,t;null==(e=this.stats)||e.begin(),requestAnimationFrame((()=>{this.animate()})),g.update(),this.renderer.setRenderTarget(this.baseTexture),this.renderer.render(this.scene,this.orthographicCamera),this.shaderMaterial&&(this.shaderMaterial.uniforms.uDisplacement.value=this.baseTexture.texture),this.renderer.setRenderTarget(null),this.renderer.clear(),this.renderer.render(this.scene1,this.orthographicCamera),this.time+=.01,this.trackMousePos(),this.meshes.forEach((e=>{e.visible&&(e.rotation.z+=.02,e.material.opacity*=.96,e.scale.x=e.scale.y=.98*e.scale.x+.1,e.material.opacity<.002&&(e.visible=!1))})),null==(t=this.stats)||t.end()}};return b((()=>{w.load()})),M((()=>{w.destroy()})),(e,t)=>(T(),f(W,null,[t[0]||(t[0]=y("div",{id:"webgl"},null,-1)),t[1]||(t[1]=y("div",{class:"title-name"},"WaterViewTwo",-1))],64))}});export{j as default};
