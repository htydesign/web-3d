var t=Object.defineProperty,e=(e,n,r)=>((e,n,r)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r)(e,"symbol"!=typeof n?n+"":n,r);import{B as n}from"./base-CepZnnqf.js";import{M as r,n as o,C as i,ae as a,a8 as s,af as l,ag as u,ah as m,ai as v,aj as d,ak as c,S as f,J as h,P as p,$ as x,a1 as g,e as w}from"./three-B4-GkLuJ.js";import{d as C,r as y,A as S,B as M,g as b,j as _,F as P,k as T,o as W,C as j,x as U,u as k}from"./@vue-Di8-S161.js";class D extends r{constructor(t,n={}){super(t),e(this,"isWater",!1),this.isWater=!0;const r=void 0!==n.textureWidth?n.textureWidth:512,h=void 0!==n.textureHeight?n.textureHeight:512,p=void 0!==n.clipBias?n.clipBias:0,x=void 0!==n.alpha?n.alpha:1,g=void 0!==n.time?n.time:0,w=void 0!==n.waterNormals?n.waterNormals:null,C=void 0!==n.sunDirection?n.sunDirection:new o(.70707,.70707,0),y=new i(void 0!==n.sunColor?n.sunColor:16777215),S=new i(void 0!==n.waterColor?n.waterColor:8355711),M=void 0!==n.eye?n.eye:new o(0,0,0),b=void 0!==n.distortionScale?n.distortionScale:20,_=void 0!==n.side?n.side:a,P=void 0!==n.fog&&n.fog,T=new s,W=new o,j=new o,U=new o,k=new l,D=new o(0,0,-1),F=new u,V=new o,z=new o,R=new u,B=new l,E=new m,A=new v(r,h),H={name:"MirrorShader",uniforms:d.merge([c.fog,c.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:0},textureMatrix:{value:new l},sunColor:{value:new i(8355711)},sunDirection:{value:new o(.70707,.70707,0)},eye:{value:new o},waterColor:{value:new i(5592405)}}]),vertexShader:"\n\t\t\t\tuniform mat4 textureMatrix;\n\t\t\t\tuniform float time;\n\n\t\t\t\tvarying vec4 mirrorCoord;\n\t\t\t\tvarying vec4 worldPosition;\n        varying vec2 vUv;\n\n\t\t\t\t#include <common>\n\t\t\t\t#include <fog_pars_vertex>\n\t\t\t\t#include <shadowmap_pars_vertex>\n\t\t\t\t#include <logdepthbuf_pars_vertex>\n\n\t\t\t\tvoid main() {\n          vUv = uv;\n\t\t\t\t\tmirrorCoord = modelMatrix * vec4( position, 1.0 );\n\t\t\t\t\tworldPosition = mirrorCoord.xyzw;\n\t\t\t\t\tmirrorCoord = textureMatrix * mirrorCoord;\n\t\t\t\t\tvec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t\t\t#include <beginnormal_vertex>\n\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t#include <fog_vertex>\n\t\t\t\t#include <shadowmap_vertex>\n\t\t\t}",fragmentShader:"\n\t\t\t\tuniform sampler2D mirrorSampler;\n\t\t\t\tuniform float alpha;\n\t\t\t\tuniform float time;\n\t\t\t\tuniform float size;\n\t\t\t\tuniform float distortionScale;\n\t\t\t\tuniform sampler2D normalSampler;\n\t\t\t\tuniform vec3 sunColor;\n\t\t\t\tuniform vec3 sunDirection;\n\t\t\t\tuniform vec3 eye;\n\t\t\t\tuniform vec3 waterColor;\n\n\t\t\t\tvarying vec4 mirrorCoord;\n\t\t\t\tvarying vec4 worldPosition;\n        varying vec2 vUv;\n\n\n\t\t\t\tvoid main() {\n\n\n\t\t\t\t\n          vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w  ) );\n\n          vec3 outgoingLight = reflectionSample;\n          outgoingLight+=waterColor;\n\n          float a = vUv.x/1.0;\n          \n\t\t\t\t\tgl_FragColor = vec4( outgoingLight, 1.0 );\n\n\n\n\t\t\t\t}"},I=new f({name:H.name,uniforms:d.clone(H.uniforms),vertexShader:H.vertexShader,fragmentShader:H.fragmentShader,lights:!0,side:_,fog:P});I.uniforms.mirrorSampler.value=A.texture,I.uniforms.textureMatrix.value=B,I.uniforms.alpha.value=x,I.uniforms.time.value=g,I.uniforms.normalSampler.value=w,I.uniforms.sunColor.value=y,I.uniforms.waterColor.value=S,I.uniforms.sunDirection.value=C,I.uniforms.distortionScale.value=b,I.uniforms.eye.value=M,this.material=I,this.onBeforeRender=function(t,e,n){if(j.setFromMatrixPosition(this.matrixWorld),U.setFromMatrixPosition(n.matrixWorld),k.extractRotation(this.matrixWorld),W.set(0,0,1),W.applyMatrix4(k),V.subVectors(j,U),V.dot(W)>0)return;V.reflect(W).negate(),V.add(j),k.extractRotation(n.matrixWorld),D.set(0,0,-1),D.applyMatrix4(k),D.add(U),z.subVectors(j,D),z.reflect(W).negate(),z.add(j),E.position.copy(V),E.up.set(0,1,0),E.up.applyMatrix4(k),E.up.reflect(W),E.lookAt(z),E.far=n.far,E.updateMatrixWorld(),E.projectionMatrix.copy(n.projectionMatrix),B.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),B.multiply(E.projectionMatrix),B.multiply(E.matrixWorldInverse),T.setFromNormalAndCoplanarPoint(W,j),T.applyMatrix4(E.matrixWorldInverse),F.set(T.normal.x,T.normal.y,T.normal.z,T.constant);const r=E.projectionMatrix;R.x=(Math.sign(F.x)+r.elements[8])/r.elements[0],R.y=(Math.sign(F.y)+r.elements[9])/r.elements[5],R.z=-1,R.w=(1+r.elements[10])/r.elements[14],F.multiplyScalar(2/F.dot(R)),r.elements[2]=F.x,r.elements[6]=F.y,r.elements[10]=F.z+1-p,r.elements[14]=F.w,M.setFromMatrixPosition(n.matrixWorld);const o=t.getRenderTarget(),i=t.xr.enabled,a=t.shadowMap.autoUpdate;this.visible=!1,t.xr.enabled=!1,t.shadowMap.autoUpdate=!1,t.setRenderTarget(A),t.state.buffers.depth.setMask(!0),!1===t.autoClear&&t.clear(),t.render(e,E),this.visible=!0,t.xr.enabled=i,t.shadowMap.autoUpdate=a,t.setRenderTarget(o);const s=n.viewport;void 0!==s&&t.state.viewport(s)}}}const F={class:"color-list"},V=["onClick"],z=C({__name:"ColorView",setup(t){const o=["#ff0000","#00ff00","#0000ff","#ffff00","#00ffff","#ff00ff","#ffffff"],a=y(0);const s=new class extends n{constructor(){super(),e(this,"uniforms",{uTime:{value:0},uStartColor:{value:new i(16776960)},uEndColor:{value:new i(16711680)}}),e(this,"isChange",!1),e(this,"reflectionCamera"),e(this,"reflectionMaterial"),e(this,"renderTarget"),e(this,"cubeCamera"),e(this,"onSelectColor",(t=>{a.value=t,this.changeColor(t)}))}load(){var t;this.init("#webgl"),this.animate(),this.create(),null==(t=this.scene)||t.remove(this.axesHelper)}create(){var t,e;const n=new f({uniforms:this.uniforms,vertexShader:"\n        uniform float uTime;\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * modelViewPosition;\n        }\n    ",fragmentShader:"\n        uniform float uTime;\n        varying vec2 vUv;\n        uniform vec3 uStartColor;\n        uniform vec3 uEndColor;\n        void main() {\n          \n            //中心点\n            vec2 center = vUv - vec2(0.5);\n\n            float negationTime = -uTime;\n\n            vec3 color = uEndColor;\n\n\n            if(center.x > uTime){\n                color = uStartColor;\n            }\n            if(center.x < negationTime){\n                color = uStartColor;\n            }\n\n            gl_FragColor = vec4(color, 1.0);\n        }\n        ",side:h}),o=new p(100,100,32,32),i=new r(o,n);i.position.y=55,null==(t=this.scene)||t.add(i);const a=new x(512);this.cubeCamera=new g(1,1e3,a);const s=new p(1e4,1e4),l=new D(s,{textureWidth:512,textureHeight:512,waterColor:3355443,distortionScale:0});l.rotation.x=-Math.PI/2,null==(e=this.scene)||e.add(l)}changeColor(t){this.isChange=!1,this.uniforms.uTime.value=0,this.uniforms.uStartColor.value=this.uniforms.uEndColor.value,this.uniforms.uEndColor.value=new i(o[t])}updateColor(){this.isChange||(this.uniforms.uTime.value<=1?this.uniforms.uTime.value+=.01:this.isChange=!0)}animate(){var t,e;null==(t=this.stats)||t.begin(),requestAnimationFrame((()=>{this.animate()})),w.update(),this.updateColor(),this.cubeCamera,this.renderer.render(this.scene,this.camera),null==(e=this.stats)||e.end()}};return S((()=>{s.load()})),M((()=>{s.destroy()})),(t,e)=>(W(),b(P,null,[e[0]||(e[0]=_("div",{id:"webgl"},null,-1)),e[1]||(e[1]=_("div",{class:"title-name"},"Color",-1)),_("div",F,[(W(),b(P,null,T(o,((t,e)=>_("div",{class:j(["color-item",a.value==e?"active":""]),key:e,style:U({background:t}),onClick:t=>k(s).onSelectColor(e)},null,14,V))),64))])],64))}});export{z as default};
