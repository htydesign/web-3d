var t=Object.defineProperty,e=(e,s,a)=>((e,s,a)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a)(e,"symbol"!=typeof s?s+"":s,a);import{B as s}from"./base-DHNtifFD.js";import{G as a,R as i,V as n,C as r,j as o,M as h,b as c,a as d,av as l,aw as w,ax as u,A as m,D as p,c as v,N as x,aj as g,P as f,B as y,a0 as M}from"./three-BrSCsmw0.js";import{d as b,r as j,z as A,A as C,g as F,j as E,C as G,F as L,o as S}from"./@vue-DBDSYTU2.js";import{_ as V}from"./index-CsOb0YUB.js";import"./pinia-Bc9svy1o.js";import"./vue-router-B45igA6V.js";class _{constructor(){e(this,"canvas",document.createElement("canvas")),e(this,"ctx"),this.ctx=this.canvas.getContext("2d")}init(t){const{text:e="",width:s=200,height:a=200}=t;return this.canvas.style.width=s+"px",this.canvas.style.height=a+"px",this.ctx.font="300px Arial",this.canvas.width=2*s,this.canvas.height=2*a,this.ctx.font="300px Arial",this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(e,this.canvas.width/2,this.canvas.height/2),this.canvas}draw(t){t(this.canvas,this.ctx)}}const B=V(b({__name:"MeasureView",setup(t){const b=j(!1);const V=new class extends s{constructor(){super(),e(this,"group",new a),e(this,"measureGroup",new a),e(this,"raycaster",new i),e(this,"pointer",new n),e(this,"startMeasure",!1),e(this,"arr",[]),e(this,"isMove",!1)}load(){var t;this.init("#webgl"),this.animate(),this.scene.background=new r(4473924),null==(t=this.scene)||t.add(this.group),this.scene.add(this.measureGroup),this.create(),window.addEventListener("mousedown",(()=>{this.isMove=!1}),!1),window.addEventListener("mousemove",(()=>{this.isMove=!0}),!1),window.addEventListener("mouseup",this.onMouseDown.bind(this),!1)}onMouseDown(t){if(!this.isMove){this.pointer.x=t.clientX/this.innerWidth*2-1,this.pointer.y=-t.clientY/this.innerHeight*2+1,this.raycaster.setFromCamera(this.pointer,this.camera);const e=this.raycaster.intersectObjects(this.group.children);e.length&&this.startMeasure&&(this.arr.push(e[0].point),this.drawLine())}}drawLine(){const t=new a;this.measureGroup.add(t);const e=new a;if(this.measureGroup.add(e),2==this.arr.length){const e=10,s=this.arr[0].distanceTo(this.arr[1]);if(s>0){this.arr.forEach(((s,a)=>{const i=new o(0,3,e,32);i.translate(0,-e/2,0);const n=new h({color:16711680}),r=new c(i,n),l=0==a?(new d).subVectors(this.arr[0],this.arr[1]):(new d).subVectors(this.arr[1],this.arr[0]);l.normalize();const w=new M;w.setFromUnitVectors(new d(0,1,0),l),r.quaternion.multiply(w),r.position.copy(s),t.add(r)}));const a=new d;a.copy(this.arr[0]),a.add(this.arr[1]),a.multiplyScalar(.5),a.y+=5;const i=new _,n=new l(i.init({text:s.toFixed(1)+"m",width:600})),r=new w(new u({map:n,color:16777215,blending:m,transparent:!0,side:p}));r.position.copy(a),r.scale.set(60,20,20),t.add(r);const f=new v,y=new x({color:16711680});f.setFromPoints(this.arr);const b=new g(f,y);t.add(b)}this.arr.length=0}}create(){var t,e;const s=new f(2e3,2e3),a=new h({color:3355443,side:p}),i=new c(s,a);i.rotateX(-Math.PI/2),null==(t=this.scene)||t.add(i);const n=new _;for(let o=0;o<10;o++){const t=75*Math.random()+25,s=new y(10,t,10),a=new h({color:new r(16777215*Math.random()),transparent:!0,opacity:1}),i=new c(s,a);i.position.set(500*Math.random()-250,t/2+.5,500*Math.random()-250);const d=new l(n.init({text:o.toString()})),m=new u({map:d,color:16711680}),p=new w(m);p.position.set(0,t/2+5,0),p.scale.set(10,10,10),i.add(p),null==(e=this.group)||e.add(i)}}createCanvas(t){const e=document.createElement("canvas"),s=e.getContext("2d");e.style.width="200px",e.style.height="200px",s.font="300px Arial";const a=t.toString();return e.width=400,e.height=400,s.font="300px Arial",s.fillStyle="white",s.textAlign="center",s.textBaseline="middle",s.fillText(a,e.width/2,e.height/2),e}animate(){var t,e;null==(t=this.stats)||t.begin(),requestAnimationFrame((()=>{this.animate()})),this.renderer&&this.renderer.render(this.scene,this.camera),null==(e=this.stats)||e.end()}},B=()=>{V.startMeasure=!V.startMeasure,b.value=V.startMeasure};return A((()=>{V.load()})),C((()=>{V.gui.close(),V.gui.destroy()})),(t,e)=>(S(),F(L,null,[e[0]||(e[0]=E("div",{id:"webgl"},null,-1)),e[1]||(e[1]=E("div",{class:"title-name"},"测量",-1)),E("div",{class:G(["measure",b.value?"active":""]),onClick:B}," 开始测量 ",2)],64))}}),[["__scopeId","data-v-6a57dc56"]]);export{B as default};
