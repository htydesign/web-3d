var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{B as s}from"./base-Blzby6IQ.js";import{C as a}from"./canvasTexture-CB5P4OHK.js";import{d as n,r,z as i,A as o,g as h,j as c,C as d,F as l,o as u}from"./@vue-DISYwsDo.js";import{G as w,R as m,V as p,C as v,j as g,M as y,b as f,a as M,aw as x,ax as b,ay as j,A as C,D as A,c as F,z as E,y as G,P as L,B as V,a2 as _}from"./three-CQ-nF5qD.js";import{_ as P}from"./index-261N8x7R.js";import"./pinia-DkR6u-JQ.js";import"./vue-router-kKGLm7zb.js";const S=P(n({__name:"MeasureView",setup(e){const n=r(!1);const P=new class extends s{constructor(){super(),t(this,"group",new w),t(this,"measureGroup",new w),t(this,"raycaster",new m),t(this,"pointer",new p),t(this,"startMeasure",!1),t(this,"arr",[]),t(this,"isMove",!1)}load(){var e;this.init("#webgl"),this.animate(),this.scene.background=new v(4473924),null==(e=this.scene)||e.add(this.group),this.scene.add(this.measureGroup),this.create(),window.addEventListener("mousedown",(()=>{this.isMove=!1}),!1),window.addEventListener("mousemove",(()=>{this.isMove=!0}),!1),window.addEventListener("mouseup",this.onMouseDown.bind(this),!1)}onMouseDown(e){if(!this.isMove){this.pointer.x=e.clientX/this.innerWidth*2-1,this.pointer.y=-e.clientY/this.innerHeight*2+1,this.raycaster.setFromCamera(this.pointer,this.camera);const t=this.raycaster.intersectObjects(this.group.children);t.length&&this.startMeasure&&(this.arr.push(t[0].point),this.drawLine())}}drawLine(){const e=new w;this.measureGroup.add(e);const t=new w;if(this.measureGroup.add(t),2==this.arr.length){const t=10,s=this.arr[0].distanceTo(this.arr[1]);if(s>0){this.arr.forEach(((s,a)=>{const n=new g(0,3,t,32);n.translate(0,-t/2,0);const r=new y({color:16711680}),i=new f(n,r),o=0==a?(new M).subVectors(this.arr[0],this.arr[1]):(new M).subVectors(this.arr[1],this.arr[0]);o.normalize();const h=new _;h.setFromUnitVectors(new M(0,1,0),o),i.quaternion.multiply(h),i.position.copy(s),e.add(i)}));const n=new M;n.copy(this.arr[0]),n.add(this.arr[1]),n.multiplyScalar(.5),n.y+=5;const r=new a,i=new x(r.init({text:s.toFixed(1)+"m",width:600})),o=new b(new j({map:i,color:16777215,blending:C,transparent:!0,side:A}));o.position.copy(n),o.scale.set(60,20,20),e.add(o);const h=new F,c=new E({color:16711680});h.setFromPoints(this.arr);const d=new G(h,c);e.add(d)}this.arr.length=0}}create(){var e,t;const s=new L(2e3,2e3),n=new y({color:3355443,side:A}),r=new f(s,n);r.rotateX(-Math.PI/2),null==(e=this.scene)||e.add(r);const i=new a;for(let a=0;a<10;a++){const e=75*Math.random()+25,s=new V(10,e,10),n=new y({color:new v(16777215*Math.random()),transparent:!0,opacity:1}),r=new f(s,n);r.position.set(500*Math.random()-250,e/2+.5,500*Math.random()-250);const o=new x(i.init({text:a.toString()})),h=new j({map:o,color:16711680}),c=new b(h);c.position.set(0,e/2+5,0),c.scale.set(10,10,10),r.add(c),null==(t=this.group)||t.add(r)}}createCanvas(e){const t=document.createElement("canvas"),s=t.getContext("2d");t.style.width="200px",t.style.height="200px",s.font="300px Arial";const a=e.toString();return t.width=400,t.height=400,s.font="300px Arial",s.fillStyle="white",s.textAlign="center",s.textBaseline="middle",s.fillText(a,t.width/2,t.height/2),t}animate(){var e,t;null==(e=this.stats)||e.begin(),requestAnimationFrame((()=>{this.animate()})),this.renderer&&this.renderer.render(this.scene,this.camera),null==(t=this.stats)||t.end()}},S=()=>{P.startMeasure=!P.startMeasure,n.value=P.startMeasure};return i((()=>{P.load()})),o((()=>{P.destroy()})),(e,t)=>(u(),h(l,null,[t[0]||(t[0]=c("div",{id:"webgl"},null,-1)),t[1]||(t[1]=c("div",{class:"title-name"},"测量",-1)),c("div",{class:d(["measure",n.value?"active":""]),onClick:S}," 开始测量 ",2)],64))}}),[["__scopeId","data-v-93620652"]]);export{S as default};
