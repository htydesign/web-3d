var e=Object.defineProperty,s=(s,t,i)=>((s,t,i)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i)(s,"symbol"!=typeof t?t+"":t,i);import{B as t}from"./base-HDikCi6F.js";import{g as i}from"./modelLoader-CZEJVq38.js";import{d as a,g as l,j as r,k as n,l as o,F as d,o as h}from"./@vue-H0c_gk4m.js";import{bd as c,G as m,aM as u,aB as b}from"./three-BHpSmIVb.js";const M=a({__name:"loaderMoreModel",setup(e){const a=new class extends t{constructor(){var e;super(),s(this,"frustum",new c),s(this,"allModels",[]),s(this,"visibleModels",new m),null==(e=this.scene)||e.add(this.visibleModels)}load(){var e;this.init("#webgl"),this.animate(),this.create(),this.sceneEnvironment(),null==(e=this.controls)||e.addEventListener("change",(()=>{this.allModels.map((e=>{this.checkVisibility(e)}))}))}create(){const e=1e3;i("./models/gltf/kira.glb").then((s=>{const t=s.scene;for(let i=0;i<200;i++){const s=t.clone();s.traverse((e=>{e.isMesh&&(e.frustumCulled=!1)})),s.scale.set(20,20,20),s.position.set(Math.random()*e-500,Math.random()*e-500,Math.random()*e-500),this.allModels.push(s),this.checkVisibility(s)}}))}checkVisibility(e){const s=new b;s.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),this.frustum.setFromProjectionMatrix(s);const t=(new u).setFromObject(e);this.frustum.intersectsBox(t)?this.visibleModels.children.find((s=>s.uuid===e.uuid))||this.visibleModels.add(e):this.visibleModels.remove(e)}animate(){var e,s;null==(e=this.stats)||e.begin(),this.timer=requestAnimationFrame((()=>{this.animate()})),this.renderer.render(this.scene,this.camera),null==(s=this.stats)||s.end()}};return l((()=>{a.load()})),r((()=>{a.destroy(),a.allModels.length=0,a.visibleModels.children.length=0})),(e,s)=>(h(),n(d,null,[s[0]||(s[0]=o("div",{id:"webgl"},null,-1)),s[1]||(s[1]=o("div",{class:"title-name"},"大量模型(200个，11.6M大小的模型)",-1))],64))}});export{M as default};
