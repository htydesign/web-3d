var e=Object.defineProperty,t=(t,s,n)=>((t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n)(t,"symbol"!=typeof s?s+"":s,n);import{B as s}from"./base-Blzby6IQ.js";import{G as n,T as o,aV as i,B as a,h as r,a as h,a_ as l,am as p,q as u,a$ as c,b0 as d,a5 as g}from"./three-CQ-nF5qD.js";import{d as x,r as m,z as v,A as w,g as b,j as k,v as f,F as j,o as y}from"./@vue-DISYwsDo.js";import{_ as I}from"./index-261N8x7R.js";import"./pinia-DkR6u-JQ.js";import"./vue-router-kKGLm7zb.js";const C={class:"operate"},M=I(x({__name:"BookView",setup(e){const x=m(!1),I=["vortex11-267x400.jpg","vortex12-320x400.jpg","vortex15-330x400.png","vortex20-267x400.jpg","vortex23-267x400.jpeg","vortex25-400x366.jpeg","vortex26-267x400.jpg","vortex31-267x400.jpg","vortex32-321x400.jpg","vortex33-267x400.jpg","vortex34-267x400.jpg","vortex35-320x400.jpg","vortex36-400x400.jpg","vortex37-320x400.jpg"];const M=new class extends s{constructor(){super(),t(this,"textureMap",[]),t(this,"currentIndex",0),t(this,"bookGroup",new n),t(this,"isOpen",!1),t(this,"closed",!1),t(this,"watermark")}load(){var e,t;this.init("#webgl"),null==(e=this.renderer)||e.setClearColor(1118481),null==(t=this.scene)||t.add(this.bookGroup),this.animate(),this.create(),this.light({type:"HemisphereLight",x:20,y:20,z:50}),this.light({type:"HemisphereLight",x:20,y:20,z:-50})}create(){const e=new o,t=[];I.forEach((s=>{t.push(new Promise((t=>{e.load("./texture/img-vortex/"+s,(e=>{t(e)}),(e=>{}),(()=>{}))})))})),this.watermark=e.load("./texture/THREEJS.png"),Promise.all(t).then((e=>{for(let t=0;t<e.length;t+=2)this.page(e[t],e[t+1],t);this.style(1)}))}annotation(){}page(e,t,s){const n={segmentHeight:2,segmentWidth:2,height:60,width:60,depth:.1,halfWidth:30,halfHeight:30,segmentCount:30};e.colorSpace=t.colorSpace=i;const o=new a(n.width,n.height,n.depth,n.segmentCount,n.segmentCount,1),g=[new r({color:0}),new r({color:16777215}),new r({color:16777215}),new r({color:16777215}),new r({color:16777215,map:e,...0===s?{roughnessMap:this.watermark}:{roughness:.1}}),new r({color:16777215,map:t,roughness:.1})],x=o.attributes.position,m=new h,v=[],w=[];for(let i=0;i<x.count;i++){m.fromBufferAttribute(x,i);const e=m.x+n.halfWidth,t=Math.floor(e/n.segmentWidth),s=e%n.segmentWidth/n.segmentWidth;v.push(t,t+1,0,0),w.push(1-s,s,0,0)}o.setAttribute("skinIndex",new l(v,4)),o.setAttribute("skinWeight",new p(w,4));const b=new u(o,g);b.position.set(n.width/2,0,0),b.castShadow=!0,b.receiveShadow=!0;const k=[];let f=new c;k.push(f),f.position.x=-n.halfHeight;for(let i=0;i<n.segmentCount;i++){const e=new c;e.position.x=n.segmentWidth,k.push(e),f.add(e),f=e}const j=new d(k);b.add(k[0]),b.bind(j),b.frustumCulled=!1,this.bookGroup.add(b)}openAnimation(){new g.Tween(this.bookGroup.rotation).to({y:-Math.PI/2,x:-Math.PI/4},1e3).easing(g.Easing.Quadratic.Out).start().onComplete((()=>{}))}closeAnimation(){this.style(),new g.Tween(this.bookGroup.rotation).to({y:0,x:0},1e3).easing(g.Easing.Quadratic.Out).start().onComplete((()=>{}))}style(e=1){const t=this.bookGroup.children;for(let s=0;s<t.length;s++){const n=t[s];n.skeleton.bones[0].rotation.y=Math.PI/2*s*.005,n.skeleton.bones[0].position.z=.1*-s,this.update(n,e)}}update(e,t=1){for(let s=1;s<e.skeleton.bones.length;s++){const n=s<8?Math.sin(.12*s+.35):0,o=s>=8?Math.cos(.3*s+.09):0,i=0===s?e.skeleton.bones[0]:e.skeleton.bones[s];let a=.1*n*Math.PI/t-.02*o*Math.PI/t;a=this.isOpen?.1*n*Math.PI/t-.02*o*Math.PI/t:0,new g.Tween(i.rotation).to({y:a},1e3).easing(g.Easing.Quadratic.Out).start().onComplete((()=>{}))}}next(){const e=this.bookGroup.children[this.currentIndex];this.update(e,-1),this.currentIndex<I.length/2-1&&this.currentIndex++,this.currentIndex===I.length/2-1&&(this.isOpen=!1,x.value=!1,this.closeAnimation())}prev(){const e=this.bookGroup.children[this.currentIndex];this.update(e,1),this.currentIndex>0&&this.currentIndex--,0===this.currentIndex&&(this.isOpen=!1,x.value=!1,this.closeAnimation())}animate(){var e,t;null==(e=this.stats)||e.begin(),requestAnimationFrame((()=>{this.animate()})),g.update(),this.renderer.render(this.scene,this.camera),null==(t=this.stats)||t.end()}},A=()=>{M.prev()},P=()=>{M.next()},G=()=>{M.currentIndex=0,M.isOpen=!0,x.value=!0,M.style(),M.openAnimation(),M.next()};return v((()=>{M.load()})),w((()=>{M.destroy()})),(e,t)=>(y(),b(j,null,[t[0]||(t[0]=k("div",{id:"webgl"},null,-1)),t[1]||(t[1]=k("div",{class:"title-name"},"书",-1)),k("div",C,[x.value?f("",!0):(y(),b("div",{key:0,class:"prev",onClick:G},"打开")),x.value?(y(),b("div",{key:1,class:"prev",onClick:A},"上一页")):f("",!0),x.value?(y(),b("div",{key:2,class:"next",onClick:P},"下一页")):f("",!0)])],64))}}),[["__scopeId","data-v-8ae77b51"]]);export{M as default};
