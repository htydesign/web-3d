var e=Object.defineProperty,t=(t,s,n)=>((t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n)(t,"symbol"!=typeof s?s+"":s,n);import{W as s}from"./webgpuBasic-RWdrGxvh.js";import{R as n,V as a,bw as i,a as o,C as r,b as l,B as h,M as c,bs as d,bu as u,bi as m,bo as p,bl as w,bn as g,bx as b,x,u as y,P as M,bk as v,by as f,I as A,O as I,n as P,bz as j,bA as C,bB as z,bv as k,aw as O,ag as _}from"./three-BHpSmIVb.js";import{g as D}from"./gsap-3GKaO8XO.js";import{d as L,g as B,j as E,k as N,l as V,F,o as S}from"./@vue-H0c_gk4m.js";const U=L({__name:"Index",setup(e){const L=new class extends s{constructor(){super(new o(0,0,40)),t(this,"pixels",[]),t(this,"rayCaster",new n),t(this,"mouse",new a),t(this,"mesh"),t(this,"progress",i([0,0,0,0,0,0,0,0,0,0])),t(this,"clickPosition",i([new o(0,0,0),new o(0,0,0),new o(0,0,0),new o(0,0,0),new o(0,0,0),new o(0,0,0),new o(0,0,0),new o(0,0,0),new o(0,0,0),new o(0,0,0)])),t(this,"waveIndex",0)}load(){var e,t;this.renderer.setClearColor(new r(0)),this.init("#webgl"),this.light({type:"DirectionalLight",x:0,y:20,z:20,intensity:100}),this.light({type:"DirectionalLight",x:0,y:-20,z:20,intensity:100}),this.light({type:"AmbientLight",x:100,y:0,z:0,intensity:1e3}),this.createCanvas(),null==(e=this.renderer)||e.setAnimationLoop((()=>{var e,t;null==(e=this.stats)||e.begin(),this.time-=.002,this.renderer.renderAsync(this.scene,this.camera),null==(t=this.stats)||t.end()}));const s=new l(new h(.5,.5,.5),new c);null==(t=this.scene)||t.add(s),document.addEventListener("click",(e=>{this.mouse.x=e.clientX/this.innerWidth*2-1,this.mouse.y=-e.clientY/this.innerHeight*2+1,this.rayCaster.setFromCamera(this.mouse,this.camera);const t=this.waveIndex,n=this.rayCaster.intersectObjects([this.mesh]);if(n.length>0){s.position.copy(n[0].point);const e={value:0};D.to(e,{value:1,duration:1,ease:"expo.out",onStart:()=>{const e=this.clickPosition.array[t];e.x=n[0].point.x,e.y=n[0].point.y,e.z=n[0].point.z},onUpdate:()=>{this.progress.array[t]=e.value}}),this.waveIndex=(this.waveIndex+1)%10}}),!1)}createCanvas(){const e=new Image;e.src="./texture/earth_specular_2048.jpg";const t=1024;e.onload=()=>{const s=document.createElement("canvas");s.width=t,s.height=t;const n=s.getContext("2d");n.drawImage(e,0,0,t,t);const a=n.getImageData(0,0,t,t),i=a.data;this.pixels=Array.from(Array(t),(()=>Array(t).fill(0)));for(let e=0;e<i.length;e+=4){const s=e/4%t,n=Math.floor(e/4/t);this.pixels[s][n]=a.data[e]<20?1:0}this.addObject();for(let e=0;e<10;e++)this.addArcs()}}addArcs(){var e;const t=d(0),s=new u({color:16777215,transparent:!0,roughness:.5,metalness:.5});s.colorNode=m((()=>{const e=t.mul(2).clamp(0,1),s=t.mul(2).sub(1).clamp(0,1),n=p(w().x,e),a=p(s,w().x);return g(b(1,1,1,1),b(0,0,0,0),n.mul(a))}))();const n=(new o).randomDirection(),a=(new o).randomDirection(),i=[];for(let l=0;l<1e3;l++){const e=l/1e3,t=Math.sin(e*Math.PI),s=(new o).lerpVectors(n,a,e).normalize().multiplyScalar(1+.2*t);i.push(s)}const r=new x(i),h=new y(r,1e3,.005,10,!1),c=new l(h,s);c.scale.set(20,20,20),null==(e=this.scene)||e.add(c),D.to(t,{value:1,repeat:-1,duration:3,delay:Math.random(),ease:"power1.inOut"})}addObject(){var e,t;const s=5e4,n=(Math.sqrt(5)+1)/2,a=[];for(let l=0;l<s;l++){const e=l/s,t=2*Math.PI*l*n,i=Math.acos(1-2*e),r=Math.sin(i)*Math.cos(t)*20,h=Math.sin(i)*Math.sin(t)*20,c=20*Math.cos(i),d=new o(r,c,h),u=1-(Math.asin(c/20)/Math.PI+.5),m=1-(Math.atan2(h/20,r/20)+Math.PI)/(2*Math.PI);this.pixels[Math.floor(1024*m)][Math.floor(1024*u)]&&a.push(d)}const i=new M(.125,.125),r=new u({color:16777215,transparent:!0,roughness:.5,metalness:.5}),h=m((()=>{const e=w().sub(v(.5)).length(),t=f(.28,.5,e).oneMinus();return b(1,0,0,t).mul(1.5)}));r.colorNode=h();const c=new A(i,r,s),d=new I;for(let o=0;o<a.length;o++)d.position.set(a[o].x,a[o].y,a[o].z),d.lookAt(2*a[o].x,2*a[o].y,2*a[o].z),d.updateMatrix(),c.setMatrixAt(o,d.matrix);c.instanceMatrix.needsUpdate=!0,null==(e=this.scene)||e.add(c);const p=new P(20,64,64),g=new u({color:16777215,roughness:.5,metalness:.5}),x=m((()=>{const e=j(0).toVar();return C(10,(({i:t})=>{const s=this.clickPosition.element(t).sub(z).length().mul(.8).sub(k(0).add(this.progress.element(t))).mul(.15),n=f(.3,.35,s).oneMinus().mul(2);n.mulAssign(f(.15,.29,s)),n.mulAssign(f(.9,1,this.progress.element(t)).oneMinus()),e.addAssign(n)})),b(e,0,0,1)}));g.colorNode=x(),this.mesh=new l(p,g),null==(t=this.scene)||t.add(this.mesh)}sceneEnvironment(){(new O).setPath("./texture/").load("venice_sunset_1k.hdr",(e=>{e.mapping=_,this.scene.environment=e}))}};return B((()=>{L.load()})),E((()=>{L.destroy()})),(e,t)=>(S(),N(F,null,[t[0]||(t[0]=V("div",{id:"webgl"},null,-1)),t[1]||(t[1]=V("div",{class:"title-name"},"earth",-1))],64))}});export{U as default};
