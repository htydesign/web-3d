var t=Object.defineProperty,e=(e,s,n)=>((e,s,n)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n)(e,"symbol"!=typeof s?s+"":s,n);import{B as s}from"./base-C9hChz8a.js";import{G as n,h as o,S as i,g as r,i as a,V as h,U as l,j as u,k as p,l as c,m as d,e as g}from"./three-BV2RzHAl.js";import{d as x,r as m,z as v,A as w,g as b,j as k,v as f,F as j,o as y}from"./@vue-B4sUqkWa.js";import{_ as I}from"./index-CuEGSuH5.js";import"./pinia-C4SihLJg.js";import"./vue-router-CANWKAPm.js";const C={class:"operate"},A=I(x({__name:"BookView",setup(t){const x=m(!1),I=["vortex11-267x400.jpg","vortex12-320x400.jpg","vortex15-330x400.png","vortex20-267x400.jpg","vortex23-267x400.jpeg","vortex25-400x366.jpeg","vortex26-267x400.jpg","vortex31-267x400.jpg","vortex32-321x400.jpg","vortex33-267x400.jpg","vortex34-267x400.jpg","vortex35-320x400.jpg","vortex36-400x400.jpg","vortex37-320x400.jpg"];const A=new class extends s{constructor(){super(),e(this,"textureMap",[]),e(this,"currentIndex",0),e(this,"bookGroup",new n),e(this,"isOpen",!1),e(this,"closed",!1),e(this,"watermark")}load(){var t,e;this.init("#webgl"),null==(t=this.renderer)||t.setClearColor(1118481),null==(e=this.scene)||e.add(this.bookGroup),this.animate(),this.create(),this.light({type:"AmbientLight",x:20,y:20,z:50}),this.light({type:"AmbientLight",x:20,y:20,z:-50})}create(){const t=new o,e=[];I.forEach((s=>{e.push(new Promise((e=>{t.load("./texture/img-vortex/"+s,(t=>{e(t)}),(t=>{}),(()=>{}))})))})),this.watermark=t.load("./texture/THREEJS.png"),Promise.all(e).then((t=>{for(let e=0;e<t.length;e+=2)this.page(t[e],t[e+1],e);this.style(1)}))}annotation(){}page(t,e,s){const n={segmentHeight:2,segmentWidth:2,height:60,width:60,depth:.1,halfWidth:30,halfHeight:30,segmentCount:30};t.colorSpace=e.colorSpace=i;const o=new r(n.width,n.height,n.depth,n.segmentCount,n.segmentCount,1),g=[new a({color:0}),new a({color:16777215}),new a({color:16777215}),new a({color:16777215}),new a({map:t,...0===s?{roughnessMap:this.watermark}:{roughness:.1}}),new a({map:e,roughness:.1})],x=o.attributes.position,m=new h,v=[],w=[];for(let i=0;i<x.count;i++){m.fromBufferAttribute(x,i);const t=m.x+n.halfWidth,e=Math.floor(t/n.segmentWidth),s=t%n.segmentWidth/n.segmentWidth;v.push(e,e+1,0,0),w.push(1-s,s,0,0)}o.setAttribute("skinIndex",new l(v,4)),o.setAttribute("skinWeight",new u(w,4));const b=new p(o,g);b.position.set(n.width/2,0,0);const k=[];let f=new c;k.push(f),f.position.x=-n.halfHeight;for(let i=0;i<n.segmentCount;i++){const t=new c;t.position.x=n.segmentWidth,k.push(t),f.add(t),f=t}const j=new d(k);b.add(k[0]),b.bind(j),b.frustumCulled=!1,this.bookGroup.add(b)}openAnimation(){new g.Tween(this.bookGroup.rotation).to({y:-Math.PI/2,x:-Math.PI/4},1e3).easing(g.Easing.Quadratic.Out).start().onComplete((()=>{}))}closeAnimation(){this.style(),new g.Tween(this.bookGroup.rotation).to({y:0,x:0},1e3).easing(g.Easing.Quadratic.Out).start().onComplete((()=>{}))}style(t=1){const e=this.bookGroup.children;for(let s=0;s<e.length;s++){const n=e[s];n.skeleton.bones[0].rotation.y=Math.PI/2*s*.005,n.skeleton.bones[0].position.z=.1*-s,this.update(n,t)}}update(t,e=1){for(let s=1;s<t.skeleton.bones.length;s++){const n=s<8?Math.sin(.12*s+.35):0,o=s>=8?Math.cos(.3*s+.09):0,i=0===s?t.skeleton.bones[0]:t.skeleton.bones[s];let r=.1*n*Math.PI/e-.02*o*Math.PI/e;r=this.isOpen?.1*n*Math.PI/e-.02*o*Math.PI/e:0,new g.Tween(i.rotation).to({y:r},1e3).easing(g.Easing.Quadratic.Out).start().onComplete((()=>{}))}}next(){const t=this.bookGroup.children[this.currentIndex];this.update(t,-1),this.currentIndex<I.length/2-1&&this.currentIndex++,this.currentIndex===I.length/2-1&&(this.isOpen=!1,x.value=!1,this.closeAnimation())}prev(){const t=this.bookGroup.children[this.currentIndex];this.update(t,1),this.currentIndex>0&&this.currentIndex--,0===this.currentIndex&&(this.isOpen=!1,x.value=!1,this.closeAnimation())}animate(){var t,e;null==(t=this.stats)||t.begin(),requestAnimationFrame((()=>{this.animate()})),g.update(),this.renderer.render(this.scene,this.camera),null==(e=this.stats)||e.end()}},M=()=>{A.prev()},P=()=>{A.next()},G=()=>{A.currentIndex=0,A.isOpen=!0,x.value=!0,A.style(),A.openAnimation(),A.next()};return v((()=>{A.load()})),w((()=>{A.gui.close(),A.gui.destroy()})),(t,e)=>(y(),b(j,null,[e[0]||(e[0]=k("div",{id:"webgl"},null,-1)),e[1]||(e[1]=k("div",{class:"title-name"},"书",-1)),k("div",C,[x.value?f("",!0):(y(),b("div",{key:0,class:"prev",onClick:G},"打开")),x.value?(y(),b("div",{key:1,class:"prev",onClick:M},"上一页")):f("",!0),x.value?(y(),b("div",{key:2,class:"next",onClick:P},"下一页")):f("",!0)])],64))}}),[["__scopeId","data-v-880fc5ba"]]);export{A as default};
