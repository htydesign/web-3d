var t=Object.defineProperty,e=(e,s,a)=>((e,s,a)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a)(e,"symbol"!=typeof s?s+"":s,a);import{B as s}from"./base-HDikCi6F.js";import{C as a}from"./canvasTexture-CB5P4OHK.js";import{d as n,r as i,g as r,j as o,k as h,l as d,H as c,F as l,o as u}from"./@vue-H0c_gk4m.js";import{G as w,R as m,V as p,C as v,j as g,M as y,b as f,a as M,ax as x,ay as b,az as j,A as C,D as F,c as A,z as E,y as G,P as L,B as V,a2 as _}from"./three-BHpSmIVb.js";import{_ as P}from"./index-DcliGhKH.js";import"./pinia-DiTk8w0t.js";import"./vue-router-DusXlGQI.js";const S=P(n({__name:"MeasureView",setup(t){const n=i(!1);const P=new class extends s{constructor(){super(),e(this,"group",new w),e(this,"measureGroup",new w),e(this,"raycaster",new m),e(this,"pointer",new p),e(this,"startMeasure",!1),e(this,"arr",[]),e(this,"isMove",!1)}load(){var t;this.init("#webgl"),this.animate(),this.scene.background=new v(4473924),null==(t=this.scene)||t.add(this.group),this.scene.add(this.measureGroup),this.create(),window.addEventListener("mousedown",(()=>{this.isMove=!1}),!1),window.addEventListener("mousemove",(()=>{this.isMove=!0}),!1),window.addEventListener("mouseup",this.onMouseDown.bind(this),!1)}onMouseDown(t){if(!this.isMove){this.pointer.x=t.clientX/this.innerWidth*2-1,this.pointer.y=-t.clientY/this.innerHeight*2+1,this.raycaster.setFromCamera(this.pointer,this.camera);const e=this.raycaster.intersectObjects(this.group.children);e.length&&this.startMeasure&&(this.arr.push(e[0].point),this.drawLine())}}drawLine(){const t=new w;this.measureGroup.add(t);const e=new w;if(this.measureGroup.add(e),2==this.arr.length){const e=10,s=this.arr[0].distanceTo(this.arr[1]);if(s>0){this.arr.forEach(((s,a)=>{const n=new g(0,3,e,32);n.translate(0,-e/2,0);const i=new y({color:16711680}),r=new f(n,i),o=0==a?(new M).subVectors(this.arr[0],this.arr[1]):(new M).subVectors(this.arr[1],this.arr[0]);o.normalize();const h=new _;h.setFromUnitVectors(new M(0,1,0),o),r.quaternion.multiply(h),r.position.copy(s),t.add(r)}));const n=new M;n.copy(this.arr[0]),n.add(this.arr[1]),n.multiplyScalar(.5),n.y+=5;const i=new a,r=new x(i.init({text:s.toFixed(1)+"m",width:600})),o=new b(new j({map:r,color:16777215,blending:C,transparent:!0,side:F}));o.position.copy(n),o.scale.set(60,20,20),t.add(o);const h=new A,d=new E({color:16711680});h.setFromPoints(this.arr);const c=new G(h,d);t.add(c)}this.arr.length=0}}create(){var t,e;const s=new L(2e3,2e3),n=new y({color:3355443,side:F}),i=new f(s,n);i.rotateX(-Math.PI/2),null==(t=this.scene)||t.add(i);const r=new a;for(let a=0;a<10;a++){const t=75*Math.random()+25,s=new V(10,t,10),n=new y({color:new v(16777215*Math.random()),transparent:!0,opacity:1}),i=new f(s,n);i.position.set(500*Math.random()-250,t/2+.5,500*Math.random()-250);const o=new x(r.init({text:a.toString()})),h=new j({map:o,color:16711680}),d=new b(h);d.position.set(0,t/2+5,0),d.scale.set(10,10,10),i.add(d),null==(e=this.group)||e.add(i)}}createCanvas(t){const e=document.createElement("canvas"),s=e.getContext("2d");e.style.width="200px",e.style.height="200px",s.font="300px Arial";const a=t.toString();return e.width=400,e.height=400,s.font="300px Arial",s.fillStyle="white",s.textAlign="center",s.textBaseline="middle",s.fillText(a,e.width/2,e.height/2),e}animate(){var t,e;null==(t=this.stats)||t.begin(),this.timer=requestAnimationFrame((()=>{this.animate()})),this.renderer&&this.renderer.render(this.scene,this.camera),null==(e=this.stats)||e.end()}},S=()=>{P.startMeasure=!P.startMeasure,n.value=P.startMeasure};return r((()=>{P.load()})),o((()=>{P.destroy()})),(t,e)=>(u(),h(l,null,[e[0]||(e[0]=d("div",{id:"webgl"},null,-1)),e[1]||(e[1]=d("div",{class:"title-name"},"测量",-1)),d("div",{class:c(["measure",n.value?"active":""]),onClick:S}," 开始测量 ",2)],64))}}),[["__scopeId","data-v-d162dac5"]]);export{S as default};
