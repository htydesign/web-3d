var t=Object.defineProperty,i=(i,e,n)=>((i,e,n)=>e in i?t(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n)(i,"symbol"!=typeof e?e+"":e,n);import{B as e}from"./base-CU2FGtE4.js";import{G as n,T as a,c as s,d as r,S as o,l as h,P as l,M as d,N as c,a as u,b as v,b1 as g,aR as p,s as m,aS as x,aT as f,a5 as w}from"./three-BbqIY5yL.js";import{d as A,z as j,A as b,g as y,j as W,F as P,o as T}from"./@vue-DISYwsDo.js";import{_ as S}from"./index-Dc6J7tEE.js";import"./pinia-DkR6u-JQ.js";import"./vue-router-kKGLm7zb.js";const M=S(A({__name:"CardSwiperView",setup(t){const A=["vortex11-267x400.jpg","vortex12-320x400.jpg","vortex15-330x400.png","vortex20-267x400.jpg","vortex23-267x400.jpeg","vortex25-400x366.jpeg","vortex26-267x400.jpg","vortex31-267x400.jpg","vortex32-321x400.jpg","vortex33-267x400.jpg","vortex34-267x400.jpg","vortex35-320x400.jpg","vortex36-400x400.jpg","vortex37-320x400.jpg","vortex38-400x267.jpg"];const S=new class extends e{constructor(){super(),i(this,"textureMap",[]),i(this,"currentIndex",0),i(this,"cardGroup",new n),i(this,"encodeGroup",new n),i(this,"isOpen",!1),i(this,"closed",!1),i(this,"watermark"),i(this,"setting",{cardWidth:60,cardHeight:36,cardMargin:10,lenWidth:0,duration:15,timeScale:.5}),i(this,"mixerArray",[]),i(this,"uniforms",{uTime:{value:0},uActive:{value:1},endTime:{value:1}}),i(this,"planePoint"),i(this,"isActive",!1)}load(){var t,i,e;this.init("#webgl"),null==(t=this.renderer)||t.setClearColor(1118481),null==(i=this.scene)||i.add(this.cardGroup),null==(e=this.scene)||e.add(this.encodeGroup),this.setting.lenWidth=A.length*(this.setting.cardWidth+this.setting.cardMargin),this.renderer.localClippingEnabled=!0,this.animate(),this.create()}create(){const t=new a,i=[];A.forEach((e=>{i.push(new Promise((i=>{t.load("./texture/img-vortex/"+e,(t=>{i(t)}),(t=>{}),(()=>{}))})))})),Promise.all(i).then((t=>{for(let i=0;i<t.length;i++)this.card(t[i],i),this.encode(i)})),this.clipPoint()}clipPoint(){var t;const i=new s,e=3e3,n=new Float32Array(9e3),a=new Float32Array(e),l=new Float32Array(e),d=new Float32Array(e);for(let s=0;s<e;s++)n[3*s+0]=0,n[3*s+1]=Math.random()*this.setting.cardHeight-this.setting.cardHeight/2,n[3*s+1]*=.99,n[3*s+2]=0,a[s]=15*Math.random(),l[s]=10*Math.random(),d[s]=10*Math.random();i.setAttribute("position",new r(n,3)),i.setAttribute("aSize",new r(a,1)),i.setAttribute("aVelocity",new r(l,1)),i.setAttribute("aDistance",new r(d,1));const c=new o({transparent:!0,uniforms:this.uniforms,vertexShader:"\n        attribute float aSize;\n        attribute float aVelocity;\n        attribute float aDistance;\n\n        varying float vSize;\n        varying float vDistance;\n        varying float traveled;\n\n        uniform float uTime;\n        uniform float endTime;\n        uniform float uActive;\n\n        void main() {\n          vSize = aSize;\n          vDistance = aDistance;\n\n          vec3 pos = position;\n\n          pos.x = mod(0.25 * aVelocity * uTime , aDistance );\n        \n\n          traveled = pos.x;\n\n          vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n          gl_PointSize= aSize * (30.0 / -mvPosition.z);\n          gl_Position = projectionMatrix * mvPosition;\n        }\n      ",fragmentShader:"\n        varying float traveled;\n\n        uniform float uActive;\n        uniform float endTime;\n\n        void main() {\n          //绘制圆点\n          if(length(gl_PointCoord - vec2(0.5)) > 0.5){\n            discard;\n          }\n          \n          float alpha = 1.0;\n          if(uActive == 0.0){\n            alpha = endTime;\n          }\n          vec3 color = vec3(1.0);\n          gl_FragColor = vec4(color, alpha);\n        }\n      "});this.planePoint=new h(i,c),this.planePoint.position.set(0,0,1),null==(t=this.scene)||t.add(this.planePoint)}card(t,i){var e;const n=new l(this.setting.cardWidth,this.setting.cardHeight),a=new d({map:t,transparent:!0,clippingPlanes:[new c(new u(-1,0,0),0)]}),s=new v(n,a);s.position.x=-this.setting.lenWidth,s.active=!1,null==(e=this.cardGroup)||e.add(s),this.animationKF(s,"card"+i,i,[-this.setting.lenWidth+this.setting.cardWidth/2,0,0,this.setting.cardWidth/2,0,0,-this.setting.lenWidth+this.setting.cardWidth/2,this.setting.cardHeight,0,-this.setting.lenWidth+this.setting.cardWidth/2,0,0],[0,1,0,0])}encode(t){var i;const e=new l(this.setting.cardWidth,this.setting.cardHeight),n=new d({color:16711680,transparent:!0,clippingPlanes:[new c(new u(1,0,0),0)]}),a=new v(e,n);a.position.x=-this.setting.cardWidth,null==(i=this.encodeGroup)||i.add(a),this.animationKF(a,"encode"+t,t,[-this.setting.cardWidth+this.setting.cardMargin,0,0,this.setting.lenWidth,0,0,-this.setting.cardWidth+this.setting.cardMargin,0,0,-this.setting.cardWidth+this.setting.cardMargin,0,0],[1,0,0,0])}animationKF(t,i,e,n,a){const s=[0,14,14,15],r=new g(".position",s,n),o=new p(".material.opacity",s,a),h=new m(t),l=h.clipAction(new x(i,s[s.length-1],[r,o]));l.loop=f,l.time=e,l.timeScale=this.setting.timeScale,l.play(),this.mixerArray.push(h)}checkIsActive(){for(let t=0;t<this.cardGroup.children.length;t++){const i=this.cardGroup.children[t];(null==i?void 0:i.position.x)>-this.setting.cardWidth/2&&!(null==i?void 0:i.active)?(i.active=!0,this.isActive=!0,this.planePoint):(null==i?void 0:i.position.x)<-this.setting.cardWidth/2&&(null==i?void 0:i.active)&&(i.active=!1,this.isActive=!1,this.planePoint)}this.isActive?(this.uniforms.uActive.value=1,this.uniforms.endTime.value>=1&&(this.uniforms.endTime.value=1),this.uniforms.endTime.value+=.1):(this.uniforms.uActive.value=0,this.uniforms.endTime.value<=0&&(this.uniforms.endTime.value=0),this.uniforms.endTime.value-=.1)}animate(){var t,i;null==(t=this.stats)||t.begin(),requestAnimationFrame((()=>{this.animate()})),w.update(),this.renderer.render(this.scene,this.camera);const e=this.clock.getDelta();for(let n=0;n<this.mixerArray.length;n++)this.mixerArray[n].update(e);this.uniforms.uTime.value+=.1,this.checkIsActive(),null==(i=this.stats)||i.end()}};return j((()=>{S.load()})),b((()=>{S.destroy()})),(t,i)=>(T(),y(P,null,[i[0]||(i[0]=W("div",{id:"webgl"},null,-1)),i[1]||(i[1]=W("div",{class:"title-name"},"卡片",-1))],64))}}),[["__scopeId","data-v-4469bbe8"]]);export{M as default};
