var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{B as s}from"./base-BPbSei19.js";import{G as a,R as n,V as i,C as r,j as o,M as h,b as c,a as d,av as l,aw as u,ax as w,A as m,D as p,c as v,N as g,aj as f,P as y,B as M,a0 as x}from"./three-BsO_Agh6.js";import{C as b}from"./canvasTexture-CB5P4OHK.js";import{d as j,r as C,z as A,A as F,g as L,j as E,C as G,F as V,o as _}from"./@vue-DISYwsDo.js";import{_ as P}from"./index-Cd8ZK_-O.js";import"./pinia-DkR6u-JQ.js";import"./vue-router-DW_NBBT6.js";const S=P(j({__name:"MeasureView",setup(e){const j=C(!1);const P=new class extends s{constructor(){super(),t(this,"group",new a),t(this,"measureGroup",new a),t(this,"raycaster",new n),t(this,"pointer",new i),t(this,"startMeasure",!1),t(this,"arr",[]),t(this,"isMove",!1)}load(){var e;this.init("#webgl"),this.animate(),this.scene.background=new r(4473924),null==(e=this.scene)||e.add(this.group),this.scene.add(this.measureGroup),this.create(),window.addEventListener("mousedown",(()=>{this.isMove=!1}),!1),window.addEventListener("mousemove",(()=>{this.isMove=!0}),!1),window.addEventListener("mouseup",this.onMouseDown.bind(this),!1)}onMouseDown(e){if(!this.isMove){this.pointer.x=e.clientX/this.innerWidth*2-1,this.pointer.y=-e.clientY/this.innerHeight*2+1,this.raycaster.setFromCamera(this.pointer,this.camera);const t=this.raycaster.intersectObjects(this.group.children);t.length&&this.startMeasure&&(this.arr.push(t[0].point),this.drawLine())}}drawLine(){const e=new a;this.measureGroup.add(e);const t=new a;if(this.measureGroup.add(t),2==this.arr.length){const t=10,s=this.arr[0].distanceTo(this.arr[1]);if(s>0){this.arr.forEach(((s,a)=>{const n=new o(0,3,t,32);n.translate(0,-t/2,0);const i=new h({color:16711680}),r=new c(n,i),l=0==a?(new d).subVectors(this.arr[0],this.arr[1]):(new d).subVectors(this.arr[1],this.arr[0]);l.normalize();const u=new x;u.setFromUnitVectors(new d(0,1,0),l),r.quaternion.multiply(u),r.position.copy(s),e.add(r)}));const a=new d;a.copy(this.arr[0]),a.add(this.arr[1]),a.multiplyScalar(.5),a.y+=5;const n=new b,i=new l(n.init({text:s.toFixed(1)+"m",width:600})),r=new u(new w({map:i,color:16777215,blending:m,transparent:!0,side:p}));r.position.copy(a),r.scale.set(60,20,20),e.add(r);const y=new v,M=new g({color:16711680});y.setFromPoints(this.arr);const j=new f(y,M);e.add(j)}this.arr.length=0}}create(){var e,t;const s=new y(2e3,2e3),a=new h({color:3355443,side:p}),n=new c(s,a);n.rotateX(-Math.PI/2),null==(e=this.scene)||e.add(n);const i=new b;for(let o=0;o<10;o++){const e=75*Math.random()+25,s=new M(10,e,10),a=new h({color:new r(16777215*Math.random()),transparent:!0,opacity:1}),n=new c(s,a);n.position.set(500*Math.random()-250,e/2+.5,500*Math.random()-250);const d=new l(i.init({text:o.toString()})),m=new w({map:d,color:16711680}),p=new u(m);p.position.set(0,e/2+5,0),p.scale.set(10,10,10),n.add(p),null==(t=this.group)||t.add(n)}}createCanvas(e){const t=document.createElement("canvas"),s=t.getContext("2d");t.style.width="200px",t.style.height="200px",s.font="300px Arial";const a=e.toString();return t.width=400,t.height=400,s.font="300px Arial",s.fillStyle="white",s.textAlign="center",s.textBaseline="middle",s.fillText(a,t.width/2,t.height/2),t}animate(){var e,t;null==(e=this.stats)||e.begin(),requestAnimationFrame((()=>{this.animate()})),this.renderer&&this.renderer.render(this.scene,this.camera),null==(t=this.stats)||t.end()}},S=()=>{P.startMeasure=!P.startMeasure,j.value=P.startMeasure};return A((()=>{P.load()})),F((()=>{P.gui.close(),P.gui.destroy()})),(e,t)=>(_(),L(V,null,[t[0]||(t[0]=E("div",{id:"webgl"},null,-1)),t[1]||(t[1]=E("div",{class:"title-name"},"测量",-1)),E("div",{class:G(["measure",j.value?"active":""]),onClick:S}," 开始测量 ",2)],64))}}),[["__scopeId","data-v-6a57dc56"]]);export{S as default};
